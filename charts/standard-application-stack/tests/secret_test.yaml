suite: Test ExternalSecret Creation
templates:
- secrets.yaml
release:
  namespace: test-namespace
tests:
- it: ArgoCD annotations
  set:
    global.clusterEnv: test
    externalSecret:
      enabled: true
      argo:
        hook: PreSync
        hookDeletePolicy: HookSucceeded
        syncWave: "-1"
  asserts:
  - matchSnapshot: {}
  - hasDocuments:
      count: 1
  - equal:
      path: metadata.annotations["argocd.argoproj.io/hook"]
      value: PreSync
  - equal:
      path: metadata.annotations["argocd.argoproj.io/hook-delete-policy"]
      value: HookSucceeded
  - equal:
      path: metadata.annotations["argocd.argoproj.io/sync-wave"]
      value: "-1"
