suite: Test Deployment Labels
release:
  namespace: test-namespace
tests:
  - it: Check default label behavior
    template: deployment.yaml
    set:
      global.name: test-app
      global.owner: sre
      global.application: test-app-different-from-name
      global.component: backend
      global.clusterEnv: qa
    asserts:
      - matchSnapshot: {} # Check for regressions and unexpected changes.
      - equal:
          path: metadata.name
          value: test-app
      - equal:
          path: metadata.labels["app.kubernetes.io/name"]
          value: test-app
      - equal:
          path: metadata.labels["app.mintel.com/owner"]
          value: sre
      - equal:
          path: metadata.labels["app.mintel.com/application"]
          value: test-app-different-from-name
      - equal:
          path: metadata.labels["app.mintel.com/component"]
          value: backend
  - it: Check empty application defaults to name
    template: deployment.yaml
    set:
      global.name: test-app
      global.owner: sre
      global.clusterEnv: qa
    asserts:
      - matchSnapshot: {} # Check for regressions and unexpected changes.
      - equal:
          path: metadata.name
          value: test-app
      - equal:
          path: metadata.labels["app.kubernetes.io/name"]
          value: test-app
      - equal:
          path: metadata.labels["app.mintel.com/application"]
          value: test-app
