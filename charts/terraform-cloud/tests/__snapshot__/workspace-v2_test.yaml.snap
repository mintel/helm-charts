Test tags:
  1: |
    apiVersion: app.terraform.io/v1alpha2
    kind: Workspace
    metadata:
      annotations:
        app.mintel.com/altManifestFileSuffix: mntl-test-app-s3
        app.mintel.com/placeholder: placeholder
        argocd.argoproj.io/sync-options: SkipDryRunOnMissingResource=true
        argocd.argoproj.io/sync-wave: "-40"
      labels:
        app.kubernetes.io/name: mntl-test-app-s3
        app.mintel.com/env: prod
        app.mintel.com/owner: sre
        app.mintel.com/region: eu-west-1
        name: mntl-test-app-s3
      name: prod-eu-west-1-cluster1-test-namespace-mntl-test-app-s3
      namespace: test-namespace
    spec:
      agentPool:
        id: ""
      allowDestroyPlan: true
      applyMethod: auto
      environmentVariables:
        - hcl: false
          name: TF_AWS_DEFAULT_TAGS_TerraformCloudWorkspace
          sensitive: false
          value: prod-eu-west-1-cluster1-test-namespace-mntl-test-app-s3
      executionMode: agent
      name: prod-eu-west-1-cluster1-test-namespace-mntl-test-app-s3
      organization: Mintel
      sshKey:
        name: mintel-ssh
      tags:
        - env:prod
        - owner:sre
        - mod:s3
        - allow-destroy:true
        - kubernetes-managed
      terraformVariables:
        - hcl: false
          name: aws_account_name
          sensitive: false
          value: prod
        - hcl: false
          name: aws_region
          sensitive: false
          value: eu-west-1
        - hcl: false
          name: eks_cluster_name
          sensitive: false
          value: cluster1
        - hcl: false
          name: name
          sensitive: false
          value: mntl-test-app
        - hcl: false
          name: output_secret_name
          sensitive: false
          value: test-namespace/mntl-test-app/s3
        - hcl: true
          name: secret_tags
          sensitive: false
          value: '{access-project = "test-namespace-ops"}'
        - hcl: true
          name: tags
          sensitive: false
          value: |-
            {
              Application = "test-app"
              Component = "test-app"
              Owner = "sre"
              Project = "test-project"
            }
        - hcl: false
          name: tfcloud_agent
          sensitive: false
          value: "true"
      terraformVersion: 1.3.10
      token:
        secretKeyRef:
          key: token
          name: terraformrc
  2: |
    apiVersion: app.terraform.io/v1alpha2
    kind: Module
    metadata:
      annotations:
        app.mintel.com/altManifestFileSuffix: mntl-test-app-s3
        app.mintel.com/placeholder: placeholder
        argocd.argoproj.io/sync-options: SkipDryRunOnMissingResource=true
        argocd.argoproj.io/sync-wave: "-40"
      labels:
        app.kubernetes.io/name: mntl-test-app-s3
        app.mintel.com/env: prod
        app.mintel.com/owner: sre
        app.mintel.com/region: eu-west-1
        name: mntl-test-app-s3
      name: prod-eu-west-1-cluster1-test-namespace-mntl-test-app-s3
      namespace: test-namespace
    spec:
      destroyOnDeletion: true
      module:
        source: app.terraform.io/Mintel/private-s3-bucket/aws
        version: 3.0.2
      name: operator
      organization: Mintel
      restartedAt: 6c781edcb3060b66cf8e41e49cb262104c2381bd331c01105f22327bc4ebf08f
      token:
        secretKeyRef:
          key: token
          name: terraformrc
      variables:
        - name: aws_account_name
        - name: aws_region
        - name: eks_cluster_name
        - name: name
        - name: output_secret_name
        - name: secret_tags
        - name: tags
        - name: tfcloud_agent
      workspace:
        name: prod-eu-west-1-cluster1-test-namespace-mntl-test-app-s3
Test tags in terraformVariables (include backstage.component):
  1: |
    apiVersion: app.terraform.io/v1alpha2
    kind: Workspace
    metadata:
      annotations:
        app.mintel.com/altManifestFileSuffix: mntl-test-app-s3
        app.mintel.com/placeholder: placeholder
        argocd.argoproj.io/sync-options: SkipDryRunOnMissingResource=true
        argocd.argoproj.io/sync-wave: "-40"
      labels:
        app.kubernetes.io/name: mntl-test-app-s3
        app.mintel.com/env: logs
        app.mintel.com/owner: sre
        app.mintel.com/region: eu-west-1
        name: mntl-test-app-s3
      name: logs-eu-west-1-cluster1-test-namespace-mntl-test-app-s3
      namespace: test-namespace
    spec:
      agentPool:
        id: ""
      allowDestroyPlan: false
      applyMethod: auto
      environmentVariables:
        - hcl: false
          name: TF_AWS_DEFAULT_TAGS_TerraformCloudWorkspace
          sensitive: false
          value: logs-eu-west-1-cluster1-test-namespace-mntl-test-app-s3
      executionMode: agent
      name: logs-eu-west-1-cluster1-test-namespace-mntl-test-app-s3
      organization: Mintel
      sshKey:
        name: mintel-ssh
      tags:
        - env:logs
        - owner:sre
        - mod:s3
        - allow-destroy:false
        - kubernetes-managed
      terraformVariables:
        - hcl: false
          name: aws_account_name
          sensitive: false
          value: logs
        - hcl: false
          name: aws_region
          sensitive: false
          value: eu-west-1
        - hcl: false
          name: eks_cluster_name
          sensitive: false
          value: cluster1
        - hcl: false
          name: name
          sensitive: false
          value: mntl-test-app
        - hcl: false
          name: output_secret_name
          sensitive: false
          value: test-namespace/mntl-test-app/s3
        - hcl: true
          name: secret_tags
          sensitive: false
          value: '{access-project = "test-namespace-ops"}'
        - hcl: true
          name: tags
          sensitive: false
          value: |-
            {
              Application = "test-app"
              Component = "test-app"
              Owner = "sre"
              Project = "test-project"
              backstage.io/component = "test-component"
            }
        - hcl: false
          name: tfcloud_agent
          sensitive: false
          value: "true"
      terraformVersion: 1.3.10
      token:
        secretKeyRef:
          key: token
          name: terraformrc
  2: |
    apiVersion: app.terraform.io/v1alpha2
    kind: Module
    metadata:
      annotations:
        app.mintel.com/altManifestFileSuffix: mntl-test-app-s3
        app.mintel.com/placeholder: placeholder
        argocd.argoproj.io/sync-options: SkipDryRunOnMissingResource=true
        argocd.argoproj.io/sync-wave: "-40"
      labels:
        app.kubernetes.io/name: mntl-test-app-s3
        app.mintel.com/env: logs
        app.mintel.com/owner: sre
        app.mintel.com/region: eu-west-1
        name: mntl-test-app-s3
      name: logs-eu-west-1-cluster1-test-namespace-mntl-test-app-s3
      namespace: test-namespace
    spec:
      destroyOnDeletion: true
      module:
        source: app.terraform.io/Mintel/private-s3-bucket/aws
        version: 3.0.2
      name: operator
      organization: Mintel
      restartedAt: d70af222e7b865ec5ee8c4facccca9d436e019432bec86347cc3801e111237ea
      token:
        secretKeyRef:
          key: token
          name: terraformrc
      variables:
        - name: aws_account_name
        - name: aws_region
        - name: eks_cluster_name
        - name: name
        - name: output_secret_name
        - name: secret_tags
        - name: tags
        - name: tfcloud_agent
      workspace:
        name: logs-eu-west-1-cluster1-test-namespace-mntl-test-app-s3
Test tags in terraformVariables (no backstage via flag):
  1: |
    apiVersion: app.terraform.io/v1alpha2
    kind: Workspace
    metadata:
      annotations:
        app.mintel.com/altManifestFileSuffix: mntl-test-app-s3
        app.mintel.com/placeholder: placeholder
        argocd.argoproj.io/sync-options: SkipDryRunOnMissingResource=true
        argocd.argoproj.io/sync-wave: "-40"
      labels:
        app.kubernetes.io/name: mntl-test-app-s3
        app.mintel.com/env: logs
        app.mintel.com/owner: sre
        app.mintel.com/region: eu-west-1
        name: mntl-test-app-s3
      name: logs-eu-west-1-cluster1-test-namespace-mntl-test-app-s3
      namespace: test-namespace
    spec:
      agentPool:
        id: ""
      allowDestroyPlan: false
      applyMethod: auto
      environmentVariables:
        - hcl: false
          name: TF_AWS_DEFAULT_TAGS_TerraformCloudWorkspace
          sensitive: false
          value: logs-eu-west-1-cluster1-test-namespace-mntl-test-app-s3
      executionMode: agent
      name: logs-eu-west-1-cluster1-test-namespace-mntl-test-app-s3
      organization: Mintel
      sshKey:
        name: mintel-ssh
      tags:
        - env:logs
        - owner:sre
        - mod:s3
        - allow-destroy:false
        - kubernetes-managed
      terraformVariables:
        - hcl: false
          name: aws_account_name
          sensitive: false
          value: logs
        - hcl: false
          name: aws_region
          sensitive: false
          value: eu-west-1
        - hcl: false
          name: eks_cluster_name
          sensitive: false
          value: cluster1
        - hcl: false
          name: name
          sensitive: false
          value: mntl-test-app
        - hcl: false
          name: output_secret_name
          sensitive: false
          value: test-namespace/mntl-test-app/s3
        - hcl: true
          name: secret_tags
          sensitive: false
          value: '{access-project = "test-namespace-ops"}'
        - hcl: true
          name: tags
          sensitive: false
          value: |-
            {
              Application = "test-app"
              Component = "test-app"
              Owner = "sre"
              Project = "test-project"
            }
        - hcl: false
          name: tfcloud_agent
          sensitive: false
          value: "true"
      terraformVersion: 1.3.10
      token:
        secretKeyRef:
          key: token
          name: terraformrc
  2: |
    apiVersion: app.terraform.io/v1alpha2
    kind: Module
    metadata:
      annotations:
        app.mintel.com/altManifestFileSuffix: mntl-test-app-s3
        app.mintel.com/placeholder: placeholder
        argocd.argoproj.io/sync-options: SkipDryRunOnMissingResource=true
        argocd.argoproj.io/sync-wave: "-40"
      labels:
        app.kubernetes.io/name: mntl-test-app-s3
        app.mintel.com/env: logs
        app.mintel.com/owner: sre
        app.mintel.com/region: eu-west-1
        name: mntl-test-app-s3
      name: logs-eu-west-1-cluster1-test-namespace-mntl-test-app-s3
      namespace: test-namespace
    spec:
      destroyOnDeletion: true
      module:
        source: app.terraform.io/Mintel/private-s3-bucket/aws
        version: 3.0.2
      name: operator
      organization: Mintel
      restartedAt: 1b8273d8b2a6e386e56efb1eaaa6f57401e219eddfdb01819449687fb3476b2e
      token:
        secretKeyRef:
          key: token
          name: terraformrc
      variables:
        - name: aws_account_name
        - name: aws_region
        - name: eks_cluster_name
        - name: name
        - name: output_secret_name
        - name: secret_tags
        - name: tags
        - name: tfcloud_agent
      workspace:
        name: logs-eu-west-1-cluster1-test-namespace-mntl-test-app-s3
Test tags in terraformVariables (no backstage.component):
  1: |
    apiVersion: app.terraform.io/v1alpha2
    kind: Workspace
    metadata:
      annotations:
        app.mintel.com/altManifestFileSuffix: mntl-test-app-s3
        app.mintel.com/placeholder: placeholder
        argocd.argoproj.io/sync-options: SkipDryRunOnMissingResource=true
        argocd.argoproj.io/sync-wave: "-40"
      labels:
        app.kubernetes.io/name: mntl-test-app-s3
        app.mintel.com/env: logs
        app.mintel.com/owner: sre
        app.mintel.com/region: eu-west-1
        name: mntl-test-app-s3
      name: logs-eu-west-1-cluster1-test-namespace-mntl-test-app-s3
      namespace: test-namespace
    spec:
      agentPool:
        id: ""
      allowDestroyPlan: false
      applyMethod: auto
      environmentVariables:
        - hcl: false
          name: TF_AWS_DEFAULT_TAGS_TerraformCloudWorkspace
          sensitive: false
          value: logs-eu-west-1-cluster1-test-namespace-mntl-test-app-s3
      executionMode: agent
      name: logs-eu-west-1-cluster1-test-namespace-mntl-test-app-s3
      organization: Mintel
      sshKey:
        name: mintel-ssh
      tags:
        - env:logs
        - owner:sre
        - mod:s3
        - allow-destroy:false
        - kubernetes-managed
      terraformVariables:
        - hcl: false
          name: aws_account_name
          sensitive: false
          value: logs
        - hcl: false
          name: aws_region
          sensitive: false
          value: eu-west-1
        - hcl: false
          name: eks_cluster_name
          sensitive: false
          value: cluster1
        - hcl: false
          name: name
          sensitive: false
          value: mntl-test-app
        - hcl: false
          name: output_secret_name
          sensitive: false
          value: test-namespace/mntl-test-app/s3
        - hcl: true
          name: secret_tags
          sensitive: false
          value: '{access-project = "test-namespace-ops"}'
        - hcl: true
          name: tags
          sensitive: false
          value: |-
            {
              Application = "test-app"
              Component = "test-app"
              Owner = "sre"
              Project = "test-project"
            }
        - hcl: false
          name: tfcloud_agent
          sensitive: false
          value: "true"
      terraformVersion: 1.3.10
      token:
        secretKeyRef:
          key: token
          name: terraformrc
  2: |
    apiVersion: app.terraform.io/v1alpha2
    kind: Module
    metadata:
      annotations:
        app.mintel.com/altManifestFileSuffix: mntl-test-app-s3
        app.mintel.com/placeholder: placeholder
        argocd.argoproj.io/sync-options: SkipDryRunOnMissingResource=true
        argocd.argoproj.io/sync-wave: "-40"
      labels:
        app.kubernetes.io/name: mntl-test-app-s3
        app.mintel.com/env: logs
        app.mintel.com/owner: sre
        app.mintel.com/region: eu-west-1
        name: mntl-test-app-s3
      name: logs-eu-west-1-cluster1-test-namespace-mntl-test-app-s3
      namespace: test-namespace
    spec:
      destroyOnDeletion: true
      module:
        source: app.terraform.io/Mintel/private-s3-bucket/aws
        version: 3.0.2
      name: operator
      organization: Mintel
      restartedAt: 1b8273d8b2a6e386e56efb1eaaa6f57401e219eddfdb01819449687fb3476b2e
      token:
        secretKeyRef:
          key: token
          name: terraformrc
      variables:
        - name: aws_account_name
        - name: aws_region
        - name: eks_cluster_name
        - name: name
        - name: output_secret_name
        - name: secret_tags
        - name: tags
        - name: tfcloud_agent
      workspace:
        name: logs-eu-west-1-cluster1-test-namespace-mntl-test-app-s3
Test tags in terraformVariables (no deprecated):
  1: |
    apiVersion: app.terraform.io/v1alpha2
    kind: Workspace
    metadata:
      annotations:
        app.mintel.com/altManifestFileSuffix: mntl-test-app-s3
        app.mintel.com/placeholder: placeholder
        argocd.argoproj.io/sync-options: SkipDryRunOnMissingResource=true
        argocd.argoproj.io/sync-wave: "-40"
      labels:
        app.kubernetes.io/name: mntl-test-app-s3
        app.mintel.com/env: logs
        app.mintel.com/owner: sre
        app.mintel.com/region: eu-west-1
        name: mntl-test-app-s3
      name: logs-eu-west-1-cluster1-test-namespace-mntl-test-app-s3
      namespace: test-namespace
    spec:
      agentPool:
        id: ""
      allowDestroyPlan: false
      applyMethod: auto
      environmentVariables:
        - hcl: false
          name: TF_AWS_DEFAULT_TAGS_TerraformCloudWorkspace
          sensitive: false
          value: logs-eu-west-1-cluster1-test-namespace-mntl-test-app-s3
      executionMode: agent
      name: logs-eu-west-1-cluster1-test-namespace-mntl-test-app-s3
      organization: Mintel
      sshKey:
        name: mintel-ssh
      tags:
        - env:logs
        - owner:sre
        - mod:s3
        - allow-destroy:false
        - kubernetes-managed
      terraformVariables:
        - hcl: false
          name: aws_account_name
          sensitive: false
          value: logs
        - hcl: false
          name: aws_region
          sensitive: false
          value: eu-west-1
        - hcl: false
          name: eks_cluster_name
          sensitive: false
          value: cluster1
        - hcl: false
          name: name
          sensitive: false
          value: mntl-test-app
        - hcl: false
          name: output_secret_name
          sensitive: false
          value: test-namespace/mntl-test-app/s3
        - hcl: true
          name: secret_tags
          sensitive: false
          value: '{access-project = "test-namespace-ops"}'
        - hcl: true
          name: tags
          sensitive: false
          value: |-
            {
              backstage.io/component = "test-component"
            }
        - hcl: false
          name: tfcloud_agent
          sensitive: false
          value: "true"
      terraformVersion: 1.3.10
      token:
        secretKeyRef:
          key: token
          name: terraformrc
  2: |
    apiVersion: app.terraform.io/v1alpha2
    kind: Module
    metadata:
      annotations:
        app.mintel.com/altManifestFileSuffix: mntl-test-app-s3
        app.mintel.com/placeholder: placeholder
        argocd.argoproj.io/sync-options: SkipDryRunOnMissingResource=true
        argocd.argoproj.io/sync-wave: "-40"
      labels:
        app.kubernetes.io/name: mntl-test-app-s3
        app.mintel.com/env: logs
        app.mintel.com/owner: sre
        app.mintel.com/region: eu-west-1
        name: mntl-test-app-s3
      name: logs-eu-west-1-cluster1-test-namespace-mntl-test-app-s3
      namespace: test-namespace
    spec:
      destroyOnDeletion: true
      module:
        source: app.terraform.io/Mintel/private-s3-bucket/aws
        version: 3.0.2
      name: operator
      organization: Mintel
      restartedAt: 4f43f2fd5f3d20102249584da7288f9ef7d6aa77ec8bbc1827711b5e601d23be
      token:
        secretKeyRef:
          key: token
          name: terraformrc
      variables:
        - name: aws_account_name
        - name: aws_region
        - name: eks_cluster_name
        - name: name
        - name: output_secret_name
        - name: secret_tags
        - name: tags
        - name: tfcloud_agent
      workspace:
        name: logs-eu-west-1-cluster1-test-namespace-mntl-test-app-s3
Test tags with env/allow-destroy flags changed:
  1: |
    apiVersion: app.terraform.io/v1alpha2
    kind: Workspace
    metadata:
      annotations:
        app.mintel.com/altManifestFileSuffix: mntl-test-app-s3
        app.mintel.com/placeholder: placeholder
        argocd.argoproj.io/sync-options: SkipDryRunOnMissingResource=true
        argocd.argoproj.io/sync-wave: "-40"
      labels:
        app.kubernetes.io/name: mntl-test-app-s3
        app.mintel.com/env: logs
        app.mintel.com/owner: sre
        app.mintel.com/region: eu-west-1
        name: mntl-test-app-s3
      name: logs-eu-west-1-cluster1-test-namespace-mntl-test-app-s3
      namespace: test-namespace
    spec:
      agentPool:
        id: ""
      allowDestroyPlan: false
      applyMethod: auto
      environmentVariables:
        - hcl: false
          name: TF_AWS_DEFAULT_TAGS_TerraformCloudWorkspace
          sensitive: false
          value: logs-eu-west-1-cluster1-test-namespace-mntl-test-app-s3
      executionMode: agent
      name: logs-eu-west-1-cluster1-test-namespace-mntl-test-app-s3
      organization: Mintel
      sshKey:
        name: mintel-ssh
      tags:
        - env:logs
        - owner:sre
        - mod:s3
        - allow-destroy:false
        - kubernetes-managed
      terraformVariables:
        - hcl: false
          name: aws_account_name
          sensitive: false
          value: logs
        - hcl: false
          name: aws_region
          sensitive: false
          value: eu-west-1
        - hcl: false
          name: eks_cluster_name
          sensitive: false
          value: cluster1
        - hcl: false
          name: name
          sensitive: false
          value: mntl-test-app
        - hcl: false
          name: output_secret_name
          sensitive: false
          value: test-namespace/mntl-test-app/s3
        - hcl: true
          name: secret_tags
          sensitive: false
          value: '{access-project = "test-namespace-ops"}'
        - hcl: true
          name: tags
          sensitive: false
          value: |-
            {
              Application = "test-app"
              Component = "test-app"
              Owner = "sre"
              Project = "test-project"
            }
        - hcl: false
          name: tfcloud_agent
          sensitive: false
          value: "true"
      terraformVersion: 1.3.10
      token:
        secretKeyRef:
          key: token
          name: terraformrc
  2: |
    apiVersion: app.terraform.io/v1alpha2
    kind: Module
    metadata:
      annotations:
        app.mintel.com/altManifestFileSuffix: mntl-test-app-s3
        app.mintel.com/placeholder: placeholder
        argocd.argoproj.io/sync-options: SkipDryRunOnMissingResource=true
        argocd.argoproj.io/sync-wave: "-40"
      labels:
        app.kubernetes.io/name: mntl-test-app-s3
        app.mintel.com/env: logs
        app.mintel.com/owner: sre
        app.mintel.com/region: eu-west-1
        name: mntl-test-app-s3
      name: logs-eu-west-1-cluster1-test-namespace-mntl-test-app-s3
      namespace: test-namespace
    spec:
      destroyOnDeletion: true
      module:
        source: app.terraform.io/Mintel/private-s3-bucket/aws
        version: 3.0.2
      name: operator
      organization: Mintel
      restartedAt: 1b8273d8b2a6e386e56efb1eaaa6f57401e219eddfdb01819449687fb3476b2e
      token:
        secretKeyRef:
          key: token
          name: terraformrc
      variables:
        - name: aws_account_name
        - name: aws_region
        - name: eks_cluster_name
        - name: name
        - name: output_secret_name
        - name: secret_tags
        - name: tags
        - name: tfcloud_agent
      workspace:
        name: logs-eu-west-1-cluster1-test-namespace-mntl-test-app-s3
Test teamAccess can be configured:
  1: |
    apiVersion: app.terraform.io/v1alpha2
    kind: Workspace
    metadata:
      annotations:
        app.mintel.com/altManifestFileSuffix: mntl-test-app-s3
        app.mintel.com/placeholder: placeholder
        argocd.argoproj.io/sync-options: SkipDryRunOnMissingResource=true
        argocd.argoproj.io/sync-wave: "-40"
      labels:
        app.kubernetes.io/name: mntl-test-app-s3
        app.mintel.com/env: logs
        app.mintel.com/owner: sre
        app.mintel.com/region: eu-west-1
        name: mntl-test-app-s3
      name: logs-eu-west-1-cluster1-test-namespace-mntl-test-app-s3
      namespace: test-namespace
    spec:
      agentPool:
        id: ""
      allowDestroyPlan: false
      applyMethod: auto
      environmentVariables:
        - hcl: false
          name: TF_AWS_DEFAULT_TAGS_TerraformCloudWorkspace
          sensitive: false
          value: logs-eu-west-1-cluster1-test-namespace-mntl-test-app-s3
      executionMode: agent
      name: logs-eu-west-1-cluster1-test-namespace-mntl-test-app-s3
      organization: Mintel
      sshKey:
        name: mintel-ssh
      tags:
        - env:logs
        - owner:sre
        - mod:s3
        - allow-destroy:false
        - kubernetes-managed
      teamAccess:
        - access: admin
          team:
            name: test-admin-team
        - access: write
          team:
            name: test-app-team
      terraformVariables:
        - hcl: false
          name: aws_account_name
          sensitive: false
          value: logs
        - hcl: false
          name: aws_region
          sensitive: false
          value: eu-west-1
        - hcl: false
          name: eks_cluster_name
          sensitive: false
          value: cluster1
        - hcl: false
          name: name
          sensitive: false
          value: mntl-test-app
        - hcl: false
          name: output_secret_name
          sensitive: false
          value: test-namespace/mntl-test-app/s3
        - hcl: true
          name: secret_tags
          sensitive: false
          value: '{access-project = "test-namespace-ops"}'
        - hcl: true
          name: tags
          sensitive: false
          value: |-
            {
              Application = "test-app"
              Component = "test-app"
              Owner = "sre"
              Project = "test-project"
            }
        - hcl: false
          name: tfcloud_agent
          sensitive: false
          value: "true"
      terraformVersion: 1.3.10
      token:
        secretKeyRef:
          key: token
          name: terraformrc
  2: |
    apiVersion: app.terraform.io/v1alpha2
    kind: Module
    metadata:
      annotations:
        app.mintel.com/altManifestFileSuffix: mntl-test-app-s3
        app.mintel.com/placeholder: placeholder
        argocd.argoproj.io/sync-options: SkipDryRunOnMissingResource=true
        argocd.argoproj.io/sync-wave: "-40"
      labels:
        app.kubernetes.io/name: mntl-test-app-s3
        app.mintel.com/env: logs
        app.mintel.com/owner: sre
        app.mintel.com/region: eu-west-1
        name: mntl-test-app-s3
      name: logs-eu-west-1-cluster1-test-namespace-mntl-test-app-s3
      namespace: test-namespace
    spec:
      destroyOnDeletion: true
      module:
        source: app.terraform.io/Mintel/private-s3-bucket/aws
        version: 3.0.2
      name: operator
      organization: Mintel
      restartedAt: 1b8273d8b2a6e386e56efb1eaaa6f57401e219eddfdb01819449687fb3476b2e
      token:
        secretKeyRef:
          key: token
          name: terraformrc
      variables:
        - name: aws_account_name
        - name: aws_region
        - name: eks_cluster_name
        - name: name
        - name: output_secret_name
        - name: secret_tags
        - name: tags
        - name: tfcloud_agent
      workspace:
        name: logs-eu-west-1-cluster1-test-namespace-mntl-test-app-s3
Test workspace allow destroy env:
  1: |
    apiVersion: app.terraform.io/v1alpha2
    kind: Workspace
    metadata:
      annotations:
        app.mintel.com/altManifestFileSuffix: mntl-test-app-s3
        app.mintel.com/placeholder: placeholder
        argocd.argoproj.io/sync-options: SkipDryRunOnMissingResource=true
        argocd.argoproj.io/sync-wave: "-40"
      labels:
        app.kubernetes.io/name: mntl-test-app-s3
        app.mintel.com/env: prod
        app.mintel.com/owner: sre
        app.mintel.com/region: eu-west-1
        name: mntl-test-app-s3
      name: prod-eu-west-1-cluster1-test-namespace-mntl-test-app-s3
      namespace: test-namespace
    spec:
      agentPool:
        id: ""
      allowDestroyPlan: false
      applyMethod: auto
      environmentVariables:
        - hcl: false
          name: TF_AWS_DEFAULT_TAGS_TerraformCloudWorkspace
          sensitive: false
          value: prod-eu-west-1-cluster1-test-namespace-mntl-test-app-s3
      executionMode: agent
      name: prod-eu-west-1-cluster1-test-namespace-mntl-test-app-s3
      organization: Mintel
      sshKey:
        name: mintel-ssh
      tags:
        - env:prod
        - owner:sre
        - mod:s3
        - allow-destroy:false
        - kubernetes-managed
      terraformVariables:
        - hcl: false
          name: aws_account_name
          sensitive: false
          value: prod
        - hcl: false
          name: aws_region
          sensitive: false
          value: eu-west-1
        - hcl: false
          name: eks_cluster_name
          sensitive: false
          value: cluster1
        - hcl: false
          name: name
          sensitive: false
          value: mntl-test-app
        - hcl: false
          name: output_secret_name
          sensitive: false
          value: test-namespace/mntl-test-app/s3
        - hcl: true
          name: secret_tags
          sensitive: false
          value: '{access-project = "test-namespace-ops"}'
        - hcl: true
          name: tags
          sensitive: false
          value: |-
            {
              Application = "test-app"
              Component = "test-app"
              Owner = "sre"
              Project = "test-project"
            }
        - hcl: false
          name: tfcloud_agent
          sensitive: false
          value: "true"
      terraformVersion: 1.3.10
      token:
        secretKeyRef:
          key: token
          name: terraformrc
  2: |
    apiVersion: app.terraform.io/v1alpha2
    kind: Module
    metadata:
      annotations:
        app.mintel.com/altManifestFileSuffix: mntl-test-app-s3
        app.mintel.com/placeholder: placeholder
        argocd.argoproj.io/sync-options: SkipDryRunOnMissingResource=true
        argocd.argoproj.io/sync-wave: "-40"
      labels:
        app.kubernetes.io/name: mntl-test-app-s3
        app.mintel.com/env: prod
        app.mintel.com/owner: sre
        app.mintel.com/region: eu-west-1
        name: mntl-test-app-s3
      name: prod-eu-west-1-cluster1-test-namespace-mntl-test-app-s3
      namespace: test-namespace
    spec:
      destroyOnDeletion: true
      module:
        source: app.terraform.io/Mintel/private-s3-bucket/aws
        version: 3.0.2
      name: operator
      organization: Mintel
      restartedAt: 6c781edcb3060b66cf8e41e49cb262104c2381bd331c01105f22327bc4ebf08f
      token:
        secretKeyRef:
          key: token
          name: terraformrc
      variables:
        - name: aws_account_name
        - name: aws_region
        - name: eks_cluster_name
        - name: name
        - name: output_secret_name
        - name: secret_tags
        - name: tags
        - name: tfcloud_agent
      workspace:
        name: prod-eu-west-1-cluster1-test-namespace-mntl-test-app-s3
Test workspace allow destroy env global-override:
  1: |
    apiVersion: app.terraform.io/v1alpha2
    kind: Workspace
    metadata:
      annotations:
        app.mintel.com/altManifestFileSuffix: mntl-test-app-s3
        app.mintel.com/placeholder: placeholder
        argocd.argoproj.io/sync-options: SkipDryRunOnMissingResource=true
        argocd.argoproj.io/sync-wave: "-40"
      labels:
        app.kubernetes.io/name: mntl-test-app-s3
        app.mintel.com/env: prod
        app.mintel.com/owner: sre
        app.mintel.com/region: eu-west-1
        name: mntl-test-app-s3
      name: prod-eu-west-1-cluster1-test-namespace-mntl-test-app-s3
      namespace: test-namespace
    spec:
      agentPool:
        id: ""
      allowDestroyPlan: true
      applyMethod: auto
      environmentVariables:
        - hcl: false
          name: TF_AWS_DEFAULT_TAGS_TerraformCloudWorkspace
          sensitive: false
          value: prod-eu-west-1-cluster1-test-namespace-mntl-test-app-s3
      executionMode: agent
      name: prod-eu-west-1-cluster1-test-namespace-mntl-test-app-s3
      organization: Mintel
      sshKey:
        name: mintel-ssh
      tags:
        - env:prod
        - owner:sre
        - mod:s3
        - allow-destroy:true
        - kubernetes-managed
      terraformVariables:
        - hcl: false
          name: aws_account_name
          sensitive: false
          value: prod
        - hcl: false
          name: aws_region
          sensitive: false
          value: eu-west-1
        - hcl: false
          name: eks_cluster_name
          sensitive: false
          value: cluster1
        - hcl: false
          name: name
          sensitive: false
          value: mntl-test-app
        - hcl: false
          name: output_secret_name
          sensitive: false
          value: test-namespace/mntl-test-app/s3
        - hcl: true
          name: secret_tags
          sensitive: false
          value: '{access-project = "test-namespace-ops"}'
        - hcl: true
          name: tags
          sensitive: false
          value: |-
            {
              Application = "test-app"
              Component = "test-app"
              Owner = "sre"
              Project = "test-project"
            }
        - hcl: false
          name: tfcloud_agent
          sensitive: false
          value: "true"
      terraformVersion: 1.3.10
      token:
        secretKeyRef:
          key: token
          name: terraformrc
  2: |
    apiVersion: app.terraform.io/v1alpha2
    kind: Module
    metadata:
      annotations:
        app.mintel.com/altManifestFileSuffix: mntl-test-app-s3
        app.mintel.com/placeholder: placeholder
        argocd.argoproj.io/sync-options: SkipDryRunOnMissingResource=true
        argocd.argoproj.io/sync-wave: "-40"
      labels:
        app.kubernetes.io/name: mntl-test-app-s3
        app.mintel.com/env: prod
        app.mintel.com/owner: sre
        app.mintel.com/region: eu-west-1
        name: mntl-test-app-s3
      name: prod-eu-west-1-cluster1-test-namespace-mntl-test-app-s3
      namespace: test-namespace
    spec:
      destroyOnDeletion: true
      module:
        source: app.terraform.io/Mintel/private-s3-bucket/aws
        version: 3.0.2
      name: operator
      organization: Mintel
      restartedAt: 6c781edcb3060b66cf8e41e49cb262104c2381bd331c01105f22327bc4ebf08f
      token:
        secretKeyRef:
          key: token
          name: terraformrc
      variables:
        - name: aws_account_name
        - name: aws_region
        - name: eks_cluster_name
        - name: name
        - name: output_secret_name
        - name: secret_tags
        - name: tags
        - name: tfcloud_agent
      workspace:
        name: prod-eu-west-1-cluster1-test-namespace-mntl-test-app-s3
Test workspace allow destroy env resource-override:
  1: |
    apiVersion: app.terraform.io/v1alpha2
    kind: Workspace
    metadata:
      annotations:
        app.mintel.com/altManifestFileSuffix: mntl-test-app-s3
        app.mintel.com/placeholder: placeholder
        argocd.argoproj.io/sync-options: SkipDryRunOnMissingResource=true
        argocd.argoproj.io/sync-wave: "-40"
      labels:
        app.kubernetes.io/name: mntl-test-app-s3
        app.mintel.com/env: prod
        app.mintel.com/owner: sre
        app.mintel.com/region: eu-west-1
        name: mntl-test-app-s3
      name: prod-eu-west-1-cluster1-test-namespace-mntl-test-app-s3
      namespace: test-namespace
    spec:
      agentPool:
        id: ""
      allowDestroyPlan: true
      applyMethod: auto
      environmentVariables:
        - hcl: false
          name: TF_AWS_DEFAULT_TAGS_TerraformCloudWorkspace
          sensitive: false
          value: prod-eu-west-1-cluster1-test-namespace-mntl-test-app-s3
      executionMode: agent
      name: prod-eu-west-1-cluster1-test-namespace-mntl-test-app-s3
      organization: Mintel
      sshKey:
        name: mintel-ssh
      tags:
        - env:prod
        - owner:sre
        - mod:s3
        - allow-destroy:true
        - kubernetes-managed
      terraformVariables:
        - hcl: false
          name: aws_account_name
          sensitive: false
          value: prod
        - hcl: false
          name: aws_region
          sensitive: false
          value: eu-west-1
        - hcl: false
          name: eks_cluster_name
          sensitive: false
          value: cluster1
        - hcl: false
          name: name
          sensitive: false
          value: mntl-test-app
        - hcl: false
          name: output_secret_name
          sensitive: false
          value: test-namespace/mntl-test-app/s3
        - hcl: true
          name: secret_tags
          sensitive: false
          value: '{access-project = "test-namespace-ops"}'
        - hcl: true
          name: tags
          sensitive: false
          value: |-
            {
              Application = "test-app"
              Component = "test-app"
              Owner = "sre"
              Project = "test-project"
            }
        - hcl: false
          name: tfcloud_agent
          sensitive: false
          value: "true"
      terraformVersion: 1.3.10
      token:
        secretKeyRef:
          key: token
          name: terraformrc
  2: |
    apiVersion: app.terraform.io/v1alpha2
    kind: Module
    metadata:
      annotations:
        app.mintel.com/altManifestFileSuffix: mntl-test-app-s3
        app.mintel.com/placeholder: placeholder
        argocd.argoproj.io/sync-options: SkipDryRunOnMissingResource=true
        argocd.argoproj.io/sync-wave: "-40"
      labels:
        app.kubernetes.io/name: mntl-test-app-s3
        app.mintel.com/env: prod
        app.mintel.com/owner: sre
        app.mintel.com/region: eu-west-1
        name: mntl-test-app-s3
      name: prod-eu-west-1-cluster1-test-namespace-mntl-test-app-s3
      namespace: test-namespace
    spec:
      destroyOnDeletion: true
      module:
        source: app.terraform.io/Mintel/private-s3-bucket/aws
        version: 3.0.2
      name: operator
      organization: Mintel
      restartedAt: de30324b0e070c6adeb8c406bbeb5fa1212a68b7e389ae32d15fc423ef027293
      token:
        secretKeyRef:
          key: token
          name: terraformrc
      variables:
        - name: aws_account_name
        - name: aws_region
        - name: eks_cluster_name
        - name: name
        - name: output_secret_name
        - name: secret_tags
        - name: tags
        - name: tfcloud_agent
      workspace:
        name: prod-eu-west-1-cluster1-test-namespace-mntl-test-app-s3
Test workspace defaults:
  1: |
    apiVersion: app.terraform.io/v1alpha2
    kind: Workspace
    metadata:
      annotations:
        app.mintel.com/altManifestFileSuffix: mntl-test-workspace-s3
        app.mintel.com/placeholder: placeholder
        argocd.argoproj.io/sync-options: SkipDryRunOnMissingResource=true
        argocd.argoproj.io/sync-wave: "-40"
      labels:
        app.kubernetes.io/name: mntl-test-workspace-s3
        app.mintel.com/env: dev
        app.mintel.com/owner: sre
        app.mintel.com/region: eu-west-1
        name: mntl-test-workspace-s3
      name: dev-eu-west-1-cluster1-test-namespace-mntl-test-workspace-s3
      namespace: test-namespace
    spec:
      agentPool:
        id: test-agent-pool
      allowDestroyPlan: true
      applyMethod: auto
      environmentVariables:
        - hcl: false
          name: TF_AWS_DEFAULT_TAGS_TerraformCloudWorkspace
          sensitive: false
          value: dev-eu-west-1-cluster1-test-namespace-mntl-test-workspace-s3
      executionMode: agent
      name: dev-eu-west-1-cluster1-test-namespace-mntl-test-workspace-s3
      organization: Mintel
      sshKey:
        name: mintel-ssh
      tags:
        - env:dev
        - owner:sre
        - mod:s3
        - allow-destroy:true
        - kubernetes-managed
      terraformVariables:
        - hcl: false
          name: aws_account_name
          sensitive: false
          value: dev
        - hcl: false
          name: aws_region
          sensitive: false
          value: eu-west-1
        - hcl: false
          name: eks_cluster_name
          sensitive: false
          value: cluster1
        - hcl: false
          name: enable_versioning
          sensitive: false
          value: "false"
        - hcl: false
          name: name
          sensitive: false
          value: mntl-test-workspace
        - hcl: false
          name: output_secret_name
          sensitive: false
          value: test-namespace/mntl-test-workspace/s3
        - hcl: true
          name: secret_tags
          sensitive: false
          value: '{access-project = "test-namespace-ops"}'
        - hcl: true
          name: tags
          sensitive: false
          value: |-
            {
              Application = "mntl-test-workspace"
              Component = "mntl-test-workspace"
              Owner = "sre"
              Project = "test-project"
            }
        - hcl: false
          name: tfcloud_agent
          sensitive: false
          value: "true"
      terraformVersion: 1.3.10
      token:
        secretKeyRef:
          key: token
          name: terraformrc
  2: |
    apiVersion: app.terraform.io/v1alpha2
    kind: Module
    metadata:
      annotations:
        app.mintel.com/altManifestFileSuffix: mntl-test-workspace-s3
        app.mintel.com/placeholder: placeholder
        argocd.argoproj.io/sync-options: SkipDryRunOnMissingResource=true
        argocd.argoproj.io/sync-wave: "-40"
      labels:
        app.kubernetes.io/name: mntl-test-workspace-s3
        app.mintel.com/env: dev
        app.mintel.com/owner: sre
        app.mintel.com/region: eu-west-1
        name: mntl-test-workspace-s3
      name: dev-eu-west-1-cluster1-test-namespace-mntl-test-workspace-s3
      namespace: test-namespace
    spec:
      destroyOnDeletion: true
      module:
        source: app.terraform.io/Mintel/private-s3-bucket/aws
        version: 3.0.2
      name: operator
      organization: Mintel
      restartedAt: 3c1404dc864aba34232dc34880ae567e3b6d92bfa68885c7104fe44dedec924b
      token:
        secretKeyRef:
          key: token
          name: terraformrc
      variables:
        - name: aws_account_name
        - name: aws_region
        - name: eks_cluster_name
        - name: enable_versioning
        - name: name
        - name: output_secret_name
        - name: secret_tags
        - name: tags
        - name: tfcloud_agent
      workspace:
        name: dev-eu-west-1-cluster1-test-namespace-mntl-test-workspace-s3
Test workspace defaults in prod-like environment (logs):
  1: |
    apiVersion: app.terraform.io/v1alpha2
    kind: Workspace
    metadata:
      annotations:
        app.mintel.com/altManifestFileSuffix: mntl-test-workspace-s3
        app.mintel.com/placeholder: placeholder
        argocd.argoproj.io/sync-options: SkipDryRunOnMissingResource=true
        argocd.argoproj.io/sync-wave: "-40"
      labels:
        app.kubernetes.io/name: mntl-test-workspace-s3
        app.mintel.com/env: logs
        app.mintel.com/owner: sre
        app.mintel.com/region: eu-west-1
        name: mntl-test-workspace-s3
      name: logs-eu-west-1-cluster1-test-namespace-mntl-test-workspace-s3
      namespace: test-namespace
    spec:
      agentPool:
        id: test-agent-pool
      allowDestroyPlan: false
      applyMethod: auto
      environmentVariables:
        - hcl: false
          name: TF_AWS_DEFAULT_TAGS_TerraformCloudWorkspace
          sensitive: false
          value: logs-eu-west-1-cluster1-test-namespace-mntl-test-workspace-s3
      executionMode: remote
      name: logs-eu-west-1-cluster1-test-namespace-mntl-test-workspace-s3
      organization: Mintel
      sshKey:
        name: mintel-ssh
      tags:
        - env:logs
        - owner:sre
        - mod:s3
        - allow-destroy:false
        - kubernetes-managed
      terraformVariables:
        - hcl: false
          name: aws_account_name
          sensitive: false
          value: logs
        - hcl: false
          name: aws_region
          sensitive: false
          value: eu-west-1
        - hcl: false
          name: eks_cluster_name
          sensitive: false
          value: cluster1
        - hcl: false
          name: name
          sensitive: false
          value: mntl-test-workspace
        - hcl: false
          name: output_secret_name
          sensitive: false
          value: test-namespace/mntl-test-workspace/s3
        - hcl: true
          name: secret_tags
          sensitive: false
          value: '{access-project = "test-namespace-ops"}'
        - hcl: true
          name: tags
          sensitive: false
          value: |-
            {
              Application = "mntl-test-workspace"
              Component = "mntl-test-workspace"
              Owner = "sre"
              Project = "test-project"
            }
        - hcl: false
          name: tfcloud_agent
          sensitive: false
          value: "true"
      terraformVersion: 1.3.10
      token:
        secretKeyRef:
          key: token
          name: terraformrc
  2: |
    apiVersion: app.terraform.io/v1alpha2
    kind: Module
    metadata:
      annotations:
        app.mintel.com/altManifestFileSuffix: mntl-test-workspace-s3
        app.mintel.com/placeholder: placeholder
        argocd.argoproj.io/sync-options: SkipDryRunOnMissingResource=true
        argocd.argoproj.io/sync-wave: "-40"
      labels:
        app.kubernetes.io/name: mntl-test-workspace-s3
        app.mintel.com/env: logs
        app.mintel.com/owner: sre
        app.mintel.com/region: eu-west-1
        name: mntl-test-workspace-s3
      name: logs-eu-west-1-cluster1-test-namespace-mntl-test-workspace-s3
      namespace: test-namespace
    spec:
      destroyOnDeletion: true
      module:
        source: app.terraform.io/Mintel/private-s3-bucket/aws
        version: 3.0.2
      name: operator
      organization: Mintel
      restartedAt: e04defbc4d25286cbf2872afacb2e563a52d79c27bd0bc2862ea7d8e6c442ba3
      token:
        secretKeyRef:
          key: token
          name: terraformrc
      variables:
        - name: aws_account_name
        - name: aws_region
        - name: eks_cluster_name
        - name: name
        - name: output_secret_name
        - name: secret_tags
        - name: tags
        - name: tfcloud_agent
      workspace:
        name: logs-eu-west-1-cluster1-test-namespace-mntl-test-workspace-s3
Test workspace defaults in prod-like environment (prod):
  1: |
    apiVersion: app.terraform.io/v1alpha2
    kind: Workspace
    metadata:
      annotations:
        app.mintel.com/altManifestFileSuffix: mntl-test-workspace-s3
        app.mintel.com/placeholder: placeholder
        argocd.argoproj.io/sync-options: SkipDryRunOnMissingResource=true
        argocd.argoproj.io/sync-wave: "-40"
      labels:
        app.kubernetes.io/name: mntl-test-workspace-s3
        app.mintel.com/env: prod
        app.mintel.com/owner: sre
        app.mintel.com/region: eu-west-1
        name: mntl-test-workspace-s3
      name: prod-eu-west-1-cluster1-test-namespace-mntl-test-workspace-s3
      namespace: test-namespace
    spec:
      agentPool:
        id: test-agent-pool
      allowDestroyPlan: false
      applyMethod: auto
      environmentVariables:
        - hcl: false
          name: TF_AWS_DEFAULT_TAGS_TerraformCloudWorkspace
          sensitive: false
          value: prod-eu-west-1-cluster1-test-namespace-mntl-test-workspace-s3
      executionMode: remote
      name: prod-eu-west-1-cluster1-test-namespace-mntl-test-workspace-s3
      organization: Mintel
      sshKey:
        name: mintel-ssh
      tags:
        - env:prod
        - owner:sre
        - mod:s3
        - allow-destroy:false
        - kubernetes-managed
      terraformVariables:
        - hcl: false
          name: aws_account_name
          sensitive: false
          value: prod
        - hcl: false
          name: aws_region
          sensitive: false
          value: eu-west-1
        - hcl: false
          name: eks_cluster_name
          sensitive: false
          value: cluster1
        - hcl: false
          name: name
          sensitive: false
          value: mntl-test-workspace
        - hcl: false
          name: output_secret_name
          sensitive: false
          value: test-namespace/mntl-test-workspace/s3
        - hcl: true
          name: secret_tags
          sensitive: false
          value: '{access-project = "test-namespace-ops"}'
        - hcl: true
          name: tags
          sensitive: false
          value: |-
            {
              Application = "mntl-test-workspace"
              Component = "mntl-test-workspace"
              Owner = "sre"
              Project = "test-project"
            }
        - hcl: false
          name: tfcloud_agent
          sensitive: false
          value: "true"
      terraformVersion: 1.3.10
      token:
        secretKeyRef:
          key: token
          name: terraformrc
  2: |
    apiVersion: app.terraform.io/v1alpha2
    kind: Module
    metadata:
      annotations:
        app.mintel.com/altManifestFileSuffix: mntl-test-workspace-s3
        app.mintel.com/placeholder: placeholder
        argocd.argoproj.io/sync-options: SkipDryRunOnMissingResource=true
        argocd.argoproj.io/sync-wave: "-40"
      labels:
        app.kubernetes.io/name: mntl-test-workspace-s3
        app.mintel.com/env: prod
        app.mintel.com/owner: sre
        app.mintel.com/region: eu-west-1
        name: mntl-test-workspace-s3
      name: prod-eu-west-1-cluster1-test-namespace-mntl-test-workspace-s3
      namespace: test-namespace
    spec:
      destroyOnDeletion: true
      module:
        source: app.terraform.io/Mintel/private-s3-bucket/aws
        version: 3.0.2
      name: operator
      organization: Mintel
      restartedAt: 2866f1e5d7f6db683ef1bba053adef8766e39314187bc830bc6d97e9a68e73a5
      token:
        secretKeyRef:
          key: token
          name: terraformrc
      variables:
        - name: aws_account_name
        - name: aws_region
        - name: eks_cluster_name
        - name: name
        - name: output_secret_name
        - name: secret_tags
        - name: tags
        - name: tfcloud_agent
      workspace:
        name: prod-eu-west-1-cluster1-test-namespace-mntl-test-workspace-s3
Test workspace instance overrides:
  1: |
    apiVersion: app.terraform.io/v1alpha2
    kind: Workspace
    metadata:
      annotations:
        app.mintel.com/altManifestFileSuffix: mntl-test-bucket-s3
        app.mintel.com/placeholder: placeholder
        argocd.argoproj.io/sync-options: SkipDryRunOnMissingResource=true
        argocd.argoproj.io/sync-wave: "-40"
      labels:
        app.kubernetes.io/name: mntl-test-bucket-s3
        app.mintel.com/env: dev
        app.mintel.com/owner: sre
        app.mintel.com/region: eu-west-1
        name: mntl-test-bucket-s3
      name: dev-eu-west-1-cluster1-test-namespace-mntl-test-bucket-s3
      namespace: test-namespace
    spec:
      agentPool:
        id: test-agent-pool
      allowDestroyPlan: true
      applyMethod: auto
      environmentVariables:
        - hcl: false
          name: TF_AWS_DEFAULT_TAGS_TerraformCloudWorkspace
          sensitive: false
          value: dev-eu-west-1-cluster1-test-namespace-mntl-test-bucket-s3
      executionMode: remote
      name: dev-eu-west-1-cluster1-test-namespace-mntl-test-bucket-s3
      organization: Mintel
      sshKey:
        name: mintel-ssh
      tags:
        - env:dev
        - owner:sre
        - mod:s3
        - allow-destroy:true
        - kubernetes-managed
      terraformVariables:
        - hcl: false
          name: aws_account_name
          sensitive: false
          value: dev
        - hcl: false
          name: aws_region
          sensitive: false
          value: eu-west-1
        - hcl: false
          name: eks_cluster_name
          sensitive: false
          value: cluster1
        - hcl: false
          name: enable_versioning
          sensitive: false
          value: "false"
        - hcl: false
          name: name
          sensitive: false
          value: mntl-test-bucket
        - hcl: false
          name: output_secret_name
          sensitive: false
          value: test-namespace/mntl-test-bucket/s3
        - hcl: true
          name: secret_tags
          sensitive: false
          value: '{access-project = "test-namespace-ops"}'
        - hcl: true
          name: tags
          sensitive: false
          value: |-
            {
              Application = "mntl-test-workspace"
              Component = "mntl-test-workspace"
              Owner = "sre"
              Project = "test-project"
            }
        - hcl: false
          name: tfcloud_agent
          sensitive: false
          value: "true"
      terraformVersion: 1.3.10
      token:
        secretKeyRef:
          key: token
          name: terraformrc
  2: |
    apiVersion: app.terraform.io/v1alpha2
    kind: Module
    metadata:
      annotations:
        app.mintel.com/altManifestFileSuffix: mntl-test-bucket-s3
        app.mintel.com/placeholder: placeholder
        argocd.argoproj.io/sync-options: SkipDryRunOnMissingResource=true
        argocd.argoproj.io/sync-wave: "-40"
      labels:
        app.kubernetes.io/name: mntl-test-bucket-s3
        app.mintel.com/env: dev
        app.mintel.com/owner: sre
        app.mintel.com/region: eu-west-1
        name: mntl-test-bucket-s3
      name: dev-eu-west-1-cluster1-test-namespace-mntl-test-bucket-s3
      namespace: test-namespace
    spec:
      destroyOnDeletion: true
      module:
        source: app.terraform.io/Mintel/private-s3-bucket/aws
        version: 3.0.2
      name: operator
      organization: Mintel
      restartedAt: 28445a52cf0063a11cbf2152bfbbb2c64a0c4810ac3ddf88c889c6456b4ee1ad
      token:
        secretKeyRef:
          key: token
          name: terraformrc
      variables:
        - name: aws_account_name
        - name: aws_region
        - name: eks_cluster_name
        - name: enable_versioning
        - name: name
        - name: output_secret_name
        - name: secret_tags
        - name: tags
        - name: tfcloud_agent
      workspace:
        name: dev-eu-west-1-cluster1-test-namespace-mntl-test-bucket-s3
  3: |
    apiVersion: app.terraform.io/v1alpha2
    kind: Workspace
    metadata:
      annotations:
        app.mintel.com/altManifestFileSuffix: mntl-test-bucket-another-s3
        app.mintel.com/placeholder: placeholder
        argocd.argoproj.io/sync-options: SkipDryRunOnMissingResource=true
        argocd.argoproj.io/sync-wave: "-40"
      labels:
        app.kubernetes.io/name: mntl-test-bucket-another-s3
        app.mintel.com/env: dev
        app.mintel.com/owner: sre
        app.mintel.com/region: eu-west-1
        name: mntl-test-bucket-another-s3
      name: dev-eu-west-1-cluster1-test-namespace-mntl-test-bucket-another-s3
      namespace: test-namespace
    spec:
      agentPool:
        id: test-agent-pool
      allowDestroyPlan: true
      applyMethod: auto
      environmentVariables:
        - hcl: false
          name: TF_AWS_DEFAULT_TAGS_TerraformCloudWorkspace
          sensitive: false
          value: dev-eu-west-1-cluster1-test-namespace-mntl-test-bucket-another-s3
      executionMode: remote
      name: dev-eu-west-1-cluster1-test-namespace-mntl-test-bucket-another-s3
      organization: Mintel
      sshKey:
        name: mintel-ssh
      tags:
        - env:dev
        - owner:sre
        - mod:s3
        - allow-destroy:true
        - kubernetes-managed
      terraformVariables:
        - hcl: false
          name: aws_account_name
          sensitive: false
          value: dev
        - hcl: false
          name: aws_region
          sensitive: false
          value: eu-west-1
        - hcl: false
          name: eks_cluster_name
          sensitive: false
          value: cluster1
        - hcl: false
          name: enable_versioning
          sensitive: false
          value: "false"
        - hcl: false
          name: name
          sensitive: false
          value: mntl-test-bucket-another
        - hcl: false
          name: output_secret_name
          sensitive: false
          value: test-namespace/mntl-test-bucket-another/s3
        - hcl: true
          name: secret_tags
          sensitive: false
          value: '{access-project = "test-namespace-ops"}'
        - hcl: true
          name: tags
          sensitive: false
          value: |-
            {
              Application = "mntl-test-workspace"
              Component = "mntl-test-workspace"
              Owner = "sre"
              Project = "test-project"
            }
        - hcl: false
          name: tfcloud_agent
          sensitive: false
          value: "true"
      terraformVersion: 1.3.10
      token:
        secretKeyRef:
          key: token
          name: terraformrc
  4: |
    apiVersion: app.terraform.io/v1alpha2
    kind: Module
    metadata:
      annotations:
        app.mintel.com/altManifestFileSuffix: mntl-test-bucket-another-s3
        app.mintel.com/placeholder: placeholder
        argocd.argoproj.io/sync-options: SkipDryRunOnMissingResource=true
        argocd.argoproj.io/sync-wave: "-40"
      labels:
        app.kubernetes.io/name: mntl-test-bucket-another-s3
        app.mintel.com/env: dev
        app.mintel.com/owner: sre
        app.mintel.com/region: eu-west-1
        name: mntl-test-bucket-another-s3
      name: dev-eu-west-1-cluster1-test-namespace-mntl-test-bucket-another-s3
      namespace: test-namespace
    spec:
      destroyOnDeletion: true
      module:
        source: app.terraform.io/Mintel/private-s3-bucket/aws
        version: 3.0.2
      name: operator
      organization: Mintel
      restartedAt: 440e5c2917e867e923be925e70e6b10a8b4cb15763758164b3f5424019eb7bbc
      token:
        secretKeyRef:
          key: token
          name: terraformrc
      variables:
        - name: aws_account_name
        - name: aws_region
        - name: eks_cluster_name
        - name: enable_versioning
        - name: name
        - name: output_secret_name
        - name: secret_tags
        - name: tags
        - name: tfcloud_agent
      workspace:
        name: dev-eu-west-1-cluster1-test-namespace-mntl-test-bucket-another-s3
Test workspace overrides:
  1: |
    apiVersion: app.terraform.io/v1alpha2
    kind: Workspace
    metadata:
      annotations:
        app.mintel.com/altManifestFileSuffix: mntl-test-workspace-s3
        app.mintel.com/placeholder: placeholder
        argocd.argoproj.io/sync-options: SkipDryRunOnMissingResource=true
        argocd.argoproj.io/sync-wave: "-40"
      labels:
        app.kubernetes.io/name: mntl-test-workspace-s3
        app.mintel.com/env: dev
        app.mintel.com/owner: sre
        app.mintel.com/region: eu-west-1
        name: mntl-test-workspace-s3
      name: dev-eu-west-1-cluster1-test-namespace-mntl-test-workspace-s3
      namespace: test-namespace
    spec:
      agentPool:
        id: test-agent-pool
      allowDestroyPlan: true
      applyMethod: auto
      environmentVariables:
        - hcl: false
          name: TF_AWS_DEFAULT_TAGS_TerraformCloudWorkspace
          sensitive: false
          value: dev-eu-west-1-cluster1-test-namespace-mntl-test-workspace-s3
      executionMode: remote
      name: dev-eu-west-1-cluster1-test-namespace-mntl-test-workspace-s3
      organization: Mintel
      sshKey:
        name: mintel-ssh
      tags:
        - env:dev
        - owner:sre
        - mod:s3
        - allow-destroy:true
        - kubernetes-managed
      terraformVariables:
        - hcl: false
          name: aws_account_name
          sensitive: false
          value: dev
        - hcl: false
          name: aws_region
          sensitive: false
          value: eu-west-1
        - hcl: false
          name: eks_cluster_name
          sensitive: false
          value: cluster1
        - hcl: false
          name: enable_versioning
          sensitive: false
          value: "false"
        - hcl: false
          name: name
          sensitive: false
          value: mntl-test-workspace
        - hcl: false
          name: output_secret_name
          sensitive: false
          value: test-namespace/mntl-test-workspace/s3
        - hcl: true
          name: secret_tags
          sensitive: false
          value: '{access-project = "test-namespace-ops"}'
        - hcl: true
          name: tags
          sensitive: false
          value: |-
            {
              Application = "mntl-test-workspace"
              Component = "mntl-test-workspace"
              Owner = "sre"
              Project = "test-project"
            }
        - hcl: false
          name: tfcloud_agent
          sensitive: false
          value: "true"
      terraformVersion: 1.3.10
      token:
        secretKeyRef:
          key: token
          name: terraformrc
  2: |
    apiVersion: app.terraform.io/v1alpha2
    kind: Module
    metadata:
      annotations:
        app.mintel.com/altManifestFileSuffix: mntl-test-workspace-s3
        app.mintel.com/placeholder: placeholder
        argocd.argoproj.io/sync-options: SkipDryRunOnMissingResource=true
        argocd.argoproj.io/sync-wave: "-40"
      labels:
        app.kubernetes.io/name: mntl-test-workspace-s3
        app.mintel.com/env: dev
        app.mintel.com/owner: sre
        app.mintel.com/region: eu-west-1
        name: mntl-test-workspace-s3
      name: dev-eu-west-1-cluster1-test-namespace-mntl-test-workspace-s3
      namespace: test-namespace
    spec:
      destroyOnDeletion: true
      module:
        source: app.terraform.io/Mintel/private-s3-bucket/aws
        version: 3.0.2
      name: operator
      organization: Mintel
      restartedAt: 3c1404dc864aba34232dc34880ae567e3b6d92bfa68885c7104fe44dedec924b
      token:
        secretKeyRef:
          key: token
          name: terraformrc
      variables:
        - name: aws_account_name
        - name: aws_region
        - name: eks_cluster_name
        - name: enable_versioning
        - name: name
        - name: output_secret_name
        - name: secret_tags
        - name: tags
        - name: tfcloud_agent
      workspace:
        name: dev-eu-west-1-cluster1-test-namespace-mntl-test-workspace-s3
Test workspace overrides at global-config level:
  1: |
    apiVersion: app.terraform.io/v1alpha2
    kind: Workspace
    metadata:
      annotations:
        app.mintel.com/altManifestFileSuffix: mntl-test-workspace-s3
        app.mintel.com/placeholder: placeholder
        argocd.argoproj.io/sync-options: SkipDryRunOnMissingResource=true
        argocd.argoproj.io/sync-wave: "-40"
      labels:
        app.kubernetes.io/name: mntl-test-workspace-s3
        app.mintel.com/env: prod
        app.mintel.com/owner: sre
        app.mintel.com/region: eu-west-1
        name: mntl-test-workspace-s3
      name: prod-eu-west-1-cluster1-test-namespace-mntl-test-workspace-s3
      namespace: test-namespace
    spec:
      agentPool:
        id: test-agent-pool
      allowDestroyPlan: true
      applyMethod: manual
      environmentVariables:
        - hcl: false
          name: TF_AWS_DEFAULT_TAGS_TerraformCloudWorkspace
          sensitive: false
          value: prod-eu-west-1-cluster1-test-namespace-mntl-test-workspace-s3
      executionMode: remote
      name: prod-eu-west-1-cluster1-test-namespace-mntl-test-workspace-s3
      organization: Mintel
      sshKey:
        name: mintel-ssh
      tags:
        - env:prod
        - owner:sre
        - mod:s3
        - allow-destroy:true
        - kubernetes-managed
      terraformVariables:
        - hcl: false
          name: aws_account_name
          sensitive: false
          value: prod
        - hcl: false
          name: aws_region
          sensitive: false
          value: eu-west-1
        - hcl: false
          name: eks_cluster_name
          sensitive: false
          value: cluster1
        - hcl: false
          name: name
          sensitive: false
          value: mntl-test-workspace
        - hcl: false
          name: output_secret_name
          sensitive: false
          value: test-namespace/mntl-test-workspace/s3
        - hcl: true
          name: secret_tags
          sensitive: false
          value: '{access-project = "test-namespace-ops"}'
        - hcl: true
          name: tags
          sensitive: false
          value: |-
            {
              Application = "mntl-test-workspace"
              Component = "mntl-test-workspace"
              Owner = "sre"
              Project = "test-project"
            }
        - hcl: false
          name: tfcloud_agent
          sensitive: false
          value: "true"
      terraformVersion: 1.3.10
      token:
        secretKeyRef:
          key: token
          name: terraformrc
  2: |
    apiVersion: app.terraform.io/v1alpha2
    kind: Module
    metadata:
      annotations:
        app.mintel.com/altManifestFileSuffix: mntl-test-workspace-s3
        app.mintel.com/placeholder: placeholder
        argocd.argoproj.io/sync-options: SkipDryRunOnMissingResource=true
        argocd.argoproj.io/sync-wave: "-40"
      labels:
        app.kubernetes.io/name: mntl-test-workspace-s3
        app.mintel.com/env: prod
        app.mintel.com/owner: sre
        app.mintel.com/region: eu-west-1
        name: mntl-test-workspace-s3
      name: prod-eu-west-1-cluster1-test-namespace-mntl-test-workspace-s3
      namespace: test-namespace
    spec:
      destroyOnDeletion: true
      module:
        source: app.terraform.io/Mintel/private-s3-bucket/aws
        version: 3.0.2
      name: operator
      organization: Mintel
      restartedAt: 2866f1e5d7f6db683ef1bba053adef8766e39314187bc830bc6d97e9a68e73a5
      token:
        secretKeyRef:
          key: token
          name: terraformrc
      variables:
        - name: aws_account_name
        - name: aws_region
        - name: eks_cluster_name
        - name: name
        - name: output_secret_name
        - name: secret_tags
        - name: tags
        - name: tfcloud_agent
      workspace:
        name: prod-eu-west-1-cluster1-test-namespace-mntl-test-workspace-s3
Test workspace overrides at resource-config level:
  1: |
    apiVersion: app.terraform.io/v1alpha2
    kind: Workspace
    metadata:
      annotations:
        app.mintel.com/altManifestFileSuffix: mntl-test-workspace-s3
        app.mintel.com/placeholder: placeholder
        argocd.argoproj.io/sync-options: SkipDryRunOnMissingResource=true
        argocd.argoproj.io/sync-wave: "-40"
      labels:
        app.kubernetes.io/name: mntl-test-workspace-s3
        app.mintel.com/env: prod
        app.mintel.com/owner: sre
        app.mintel.com/region: eu-west-1
        name: mntl-test-workspace-s3
      name: prod-eu-west-1-cluster1-test-namespace-mntl-test-workspace-s3
      namespace: test-namespace
    spec:
      agentPool:
        id: test-agent-pool
      allowDestroyPlan: true
      applyMethod: manual
      environmentVariables:
        - hcl: false
          name: TF_AWS_DEFAULT_TAGS_TerraformCloudWorkspace
          sensitive: false
          value: prod-eu-west-1-cluster1-test-namespace-mntl-test-workspace-s3
      executionMode: remote
      name: prod-eu-west-1-cluster1-test-namespace-mntl-test-workspace-s3
      organization: Mintel
      sshKey:
        name: mintel-ssh
      tags:
        - env:prod
        - owner:sre
        - mod:s3
        - allow-destroy:true
        - kubernetes-managed
      terraformVariables:
        - hcl: false
          name: aws_account_name
          sensitive: false
          value: prod
        - hcl: false
          name: aws_region
          sensitive: false
          value: eu-west-1
        - hcl: false
          name: eks_cluster_name
          sensitive: false
          value: cluster1
        - hcl: false
          name: name
          sensitive: false
          value: mntl-test-workspace
        - hcl: false
          name: output_secret_name
          sensitive: false
          value: test-namespace/mntl-test-workspace/s3
        - hcl: true
          name: secret_tags
          sensitive: false
          value: '{access-project = "test-namespace-ops"}'
        - hcl: true
          name: tags
          sensitive: false
          value: |-
            {
              Application = "mntl-test-workspace"
              Component = "mntl-test-workspace"
              Owner = "sre"
              Project = "test-project"
            }
        - hcl: false
          name: tfcloud_agent
          sensitive: false
          value: "true"
      terraformVersion: 1.3.10
      token:
        secretKeyRef:
          key: token
          name: terraformrc
  2: |
    apiVersion: app.terraform.io/v1alpha2
    kind: Module
    metadata:
      annotations:
        app.mintel.com/altManifestFileSuffix: mntl-test-workspace-s3
        app.mintel.com/placeholder: placeholder
        argocd.argoproj.io/sync-options: SkipDryRunOnMissingResource=true
        argocd.argoproj.io/sync-wave: "-40"
      labels:
        app.kubernetes.io/name: mntl-test-workspace-s3
        app.mintel.com/env: prod
        app.mintel.com/owner: sre
        app.mintel.com/region: eu-west-1
        name: mntl-test-workspace-s3
      name: prod-eu-west-1-cluster1-test-namespace-mntl-test-workspace-s3
      namespace: test-namespace
    spec:
      destroyOnDeletion: true
      module:
        source: app.terraform.io/Mintel/private-s3-bucket/aws
        version: 3.0.2
      name: operator
      organization: Mintel
      restartedAt: b867126e587da27fc212b062254934d2da9b74242cc83fc6d73a53a7dcd9cef5
      token:
        secretKeyRef:
          key: token
          name: terraformrc
      variables:
        - name: aws_account_name
        - name: aws_region
        - name: eks_cluster_name
        - name: name
        - name: output_secret_name
        - name: secret_tags
        - name: tags
        - name: tfcloud_agent
      workspace:
        name: prod-eu-west-1-cluster1-test-namespace-mntl-test-workspace-s3
