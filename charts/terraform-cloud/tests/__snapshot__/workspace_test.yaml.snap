Dev S3 module name label override:
  1: |
    apiVersion: app.terraform.io/v1alpha1
    kind: Workspace
    metadata:
      annotations:
        app.mintel.com/altManifestFileSuffix: mntl-test-app-s3
        app.mintel.com/placeholder: placeholder
        app.mintel.com/terraform-allow-destroy: "true"
        app.mintel.com/terraform-cloud-tags: env:dev,owner:sre,mod:s3
        app.mintel.com/terraform-owner: sre
        argocd.argoproj.io/sync-options: SkipDryRunOnMissingResource=true
        argocd.argoproj.io/sync-wave: "-40"
      labels:
        app.kubernetes.io/name: mntl-test-app-s3
        app.mintel.com/env: dev
        app.mintel.com/owner: sre
        app.mintel.com/region: eu-west-1
        name: mntl-test-app-s3
      name: dev-eu-west-1-cluster1-test-namespace-mntl-test-app-s3
      namespace: test-namespace
    spec:
      agentPoolID: ""
      module:
        source: app.terraform.io/Mintel/private-s3-bucket/aws
        version: 2.0.5
      omitNamespacePrefix: true
      organization: Mintel
      secretsMountPath: /tmp/secrets
      sshKeyID: mintel-ssh
      terraformVersion: 1.2.9
      variables:
        - environmentVariable: false
          hcl: false
          key: aws_account_name
          sensitive: false
          value: dev
        - environmentVariable: false
          hcl: false
          key: aws_region
          sensitive: false
          value: eu-west-1
        - environmentVariable: false
          hcl: false
          key: eks_cluster_name
          sensitive: false
          value: cluster1
        - environmentVariable: false
          hcl: false
          key: enable_versioning
          sensitive: false
          value: "false"
        - environmentVariable: false
          hcl: false
          key: name
          sensitive: false
          value: mntl-test-app
        - environmentVariable: false
          hcl: false
          key: output_secret_name
          sensitive: false
          value: test-namespace/mntl-test-app/s3
        - environmentVariable: false
          hcl: true
          key: secret_tags
          sensitive: false
          value: '{access-project = "test-namespace-ops"}'
        - environmentVariable: false
          hcl: true
          key: tags
          sensitive: false
          value: |-
            {
              Application = "mntl-test-app"
              Component = "mntl-test-app"
              Owner = "sre"
              Project = "test-project"
            }
        - environmentVariable: false
          hcl: false
          key: tfcloud_agent
          sensitive: false
          value: "true"
Dev S3 module workspace:
  1: |
    apiVersion: app.terraform.io/v1alpha1
    kind: Workspace
    metadata:
      annotations:
        app.mintel.com/altManifestFileSuffix: mntl-test-app-s3
        app.mintel.com/placeholder: placeholder
        app.mintel.com/terraform-allow-destroy: "true"
        app.mintel.com/terraform-cloud-tags: env:dev,owner:sre,mod:s3
        app.mintel.com/terraform-owner: sre
        argocd.argoproj.io/sync-options: SkipDryRunOnMissingResource=true
        argocd.argoproj.io/sync-wave: "-40"
      labels:
        app.kubernetes.io/name: mntl-test-app-s3
        app.mintel.com/env: dev
        app.mintel.com/owner: sre
        app.mintel.com/region: eu-west-1
        name: mntl-test-app-s3
      name: dev-eu-west-1-cluster1-test-namespace-mntl-test-app-s3
      namespace: test-namespace
    spec:
      agentPoolID: ""
      module:
        source: app.terraform.io/Mintel/private-s3-bucket/aws
        version: 2.0.5
      omitNamespacePrefix: true
      organization: Mintel
      secretsMountPath: /tmp/secrets
      sshKeyID: mintel-ssh
      terraformVersion: 1.2.9
      variables:
        - environmentVariable: false
          hcl: false
          key: aws_account_name
          sensitive: false
          value: dev
        - environmentVariable: false
          hcl: false
          key: aws_region
          sensitive: false
          value: eu-west-1
        - environmentVariable: false
          hcl: false
          key: eks_cluster_name
          sensitive: false
          value: cluster1
        - environmentVariable: false
          hcl: false
          key: enable_versioning
          sensitive: false
          value: "false"
        - environmentVariable: false
          hcl: false
          key: name
          sensitive: false
          value: mntl-test-app
        - environmentVariable: false
          hcl: false
          key: output_secret_name
          sensitive: false
          value: test-namespace/mntl-test-app/s3
        - environmentVariable: false
          hcl: true
          key: secret_tags
          sensitive: false
          value: '{access-project = "test-namespace-ops"}'
        - environmentVariable: false
          hcl: true
          key: tags
          sensitive: false
          value: |-
            {
              Application = "test-app"
              Component = "test-app"
              Owner = "sre"
              Project = "test-project"
            }
        - environmentVariable: false
          hcl: false
          key: tfcloud_agent
          sensitive: false
          value: "true"
Dev S3 module workspace - tags:
  1: |
    apiVersion: app.terraform.io/v1alpha1
    kind: Workspace
    metadata:
      annotations:
        app.mintel.com/altManifestFileSuffix: test-sqs-sqs
        app.mintel.com/placeholder: placeholder
        app.mintel.com/terraform-allow-destroy: "true"
        app.mintel.com/terraform-cloud-tags: env:dev,owner:sre,mod:sqs
        app.mintel.com/terraform-owner: sre
        argocd.argoproj.io/sync-options: SkipDryRunOnMissingResource=true
        argocd.argoproj.io/sync-wave: "-40"
      labels:
        app.kubernetes.io/name: test-sqs-sqs
        app.mintel.com/env: dev
        app.mintel.com/owner: sre
        app.mintel.com/region: eu-west-1
        name: test-sqs-sqs
      name: dev-eu-west-1-cluster1-test-namespace-test-sqs-sqs
      namespace: test-namespace
    spec:
      agentPoolID: ""
      module:
        source: app.terraform.io/Mintel/sqs/aws
        version: 1.2.0
      omitNamespacePrefix: true
      organization: Mintel
      secretsMountPath: /tmp/secrets
      sshKeyID: mintel-ssh
      terraformVersion: 1.2.9
      variables:
        - environmentVariable: false
          hcl: false
          key: aws_account_name
          sensitive: false
          value: dev
        - environmentVariable: false
          hcl: false
          key: aws_region
          sensitive: false
          value: eu-west-1
        - environmentVariable: false
          hcl: false
          key: eks_cluster_name
          sensitive: false
          value: cluster1
        - environmentVariable: false
          hcl: false
          key: name
          sensitive: false
          value: test-sqs
        - environmentVariable: false
          hcl: false
          key: output_secret_name
          sensitive: false
          value: test-namespace/test-sqs/sqs
        - environmentVariable: false
          hcl: true
          key: secret_tags
          sensitive: false
          value: '{access-project = "test-namespace-ops"}'
        - environmentVariable: false
          hcl: true
          key: tags
          sensitive: false
          value: |-
            {
              Application = "test-app"
              Component = "test-app"
              ExtraTagOne = "testTagValueOne"
              ExtraTagTwo = "testTagValueTwo"
              MintelEventBus = "true"
              Owner = "sre"
              Project = "test-project"
            }
        - environmentVariable: false
          hcl: false
          key: tfcloud_agent
          sensitive: false
          value: "true"
Dev S3 module workspace adds correct env override:
  1: |
    apiVersion: app.terraform.io/v1alpha1
    kind: Workspace
    metadata:
      annotations:
        app.mintel.com/altManifestFileSuffix: mntl-test-app-s3
        app.mintel.com/placeholder: placeholder
        app.mintel.com/terraform-allow-destroy: "true"
        app.mintel.com/terraform-cloud-tags: env:dev,owner:sre,mod:s3
        app.mintel.com/terraform-owner: sre
        argocd.argoproj.io/sync-options: SkipDryRunOnMissingResource=true
        argocd.argoproj.io/sync-wave: "-40"
      labels:
        app.kubernetes.io/name: mntl-test-app-s3
        app.mintel.com/env: dev
        app.mintel.com/owner: sre
        app.mintel.com/region: eu-west-1
        name: mntl-test-app-s3
      name: dev-eu-west-1-cluster1-test-namespace-mntl-test-app-s3
      namespace: test-namespace
    spec:
      agentPoolID: ""
      module:
        source: app.terraform.io/Mintel/private-s3-bucket/aws
        version: 2.0.5
      omitNamespacePrefix: true
      organization: Mintel
      secretsMountPath: /tmp/secrets
      sshKeyID: mintel-ssh
      terraformVersion: 1.2.9
      variables:
        - environmentVariable: false
          hcl: false
          key: aws_account_name
          sensitive: false
          value: dev
        - environmentVariable: false
          hcl: false
          key: aws_region
          sensitive: false
          value: eu-west-1
        - environmentVariable: false
          hcl: false
          key: eks_cluster_name
          sensitive: false
          value: cluster1
        - environmentVariable: false
          hcl: false
          key: enable_versioning
          sensitive: false
          value: "false"
        - environmentVariable: false
          hcl: false
          key: name
          sensitive: false
          value: mntl-test-app
        - environmentVariable: false
          hcl: false
          key: output_secret_name
          sensitive: false
          value: test-namespace/mntl-test-app/s3
        - environmentVariable: false
          hcl: true
          key: secret_tags
          sensitive: false
          value: '{access-project = "test-namespace-ops"}'
        - environmentVariable: false
          hcl: true
          key: tags
          sensitive: false
          value: |-
            {
              Application = "mntl-test-app"
              Component = "mntl-test-app"
              Owner = "sre"
              Project = "test-project"
            }
        - environmentVariable: false
          hcl: false
          key: tfcloud_agent
          sensitive: false
          value: "true"
Dev S3 module workspace ignores env override when added explicitly:
  1: |
    apiVersion: app.terraform.io/v1alpha1
    kind: Workspace
    metadata:
      annotations:
        app.mintel.com/altManifestFileSuffix: mntl-test-app-s3
        app.mintel.com/placeholder: placeholder
        app.mintel.com/terraform-allow-destroy: "true"
        app.mintel.com/terraform-cloud-tags: env:dev,owner:sre,mod:s3
        app.mintel.com/terraform-owner: sre
        argocd.argoproj.io/sync-options: SkipDryRunOnMissingResource=true
        argocd.argoproj.io/sync-wave: "-40"
      labels:
        app.kubernetes.io/name: mntl-test-app-s3
        app.mintel.com/env: dev
        app.mintel.com/owner: sre
        app.mintel.com/region: eu-west-1
        name: mntl-test-app-s3
      name: dev-eu-west-1-cluster1-test-namespace-mntl-test-app-s3
      namespace: test-namespace
    spec:
      agentPoolID: ""
      module:
        source: app.terraform.io/Mintel/private-s3-bucket/aws
        version: 2.0.5
      omitNamespacePrefix: true
      organization: Mintel
      secretsMountPath: /tmp/secrets
      sshKeyID: mintel-ssh
      terraformVersion: 1.2.9
      variables:
        - environmentVariable: false
          hcl: false
          key: aws_account_name
          sensitive: false
          value: dev
        - environmentVariable: false
          hcl: false
          key: aws_region
          sensitive: false
          value: eu-west-1
        - environmentVariable: false
          hcl: false
          key: eks_cluster_name
          sensitive: false
          value: cluster1
        - environmentVariable: false
          hcl: false
          key: enable_versioning
          sensitive: false
          value: "true"
        - environmentVariable: false
          hcl: false
          key: name
          sensitive: false
          value: mntl-test-app
        - environmentVariable: false
          hcl: false
          key: output_secret_name
          sensitive: false
          value: test-namespace/mntl-test-app/s3
        - environmentVariable: false
          hcl: true
          key: secret_tags
          sensitive: false
          value: '{access-project = "test-namespace-ops"}'
        - environmentVariable: false
          hcl: true
          key: tags
          sensitive: false
          value: |-
            {
              Application = "mntl-test-app"
              Component = "mntl-test-app"
              Owner = "sre"
              Project = "test-project"
            }
        - environmentVariable: false
          hcl: false
          key: tfcloud_agent
          sensitive: false
          value: "true"
Dev S3 module workspace name does not repeat mntl-prefix:
  1: |
    apiVersion: app.terraform.io/v1alpha1
    kind: Workspace
    metadata:
      annotations:
        app.mintel.com/altManifestFileSuffix: mntl-test-app-s3
        app.mintel.com/placeholder: placeholder
        app.mintel.com/terraform-allow-destroy: "true"
        app.mintel.com/terraform-cloud-tags: env:dev,owner:sre,mod:s3
        app.mintel.com/terraform-owner: sre
        argocd.argoproj.io/sync-options: SkipDryRunOnMissingResource=true
        argocd.argoproj.io/sync-wave: "-40"
      labels:
        app.kubernetes.io/name: mntl-test-app-s3
        app.mintel.com/env: dev
        app.mintel.com/owner: sre
        app.mintel.com/region: eu-west-1
        name: mntl-test-app-s3
      name: dev-eu-west-1-cluster1-test-namespace-mntl-test-app-s3
      namespace: test-namespace
    spec:
      agentPoolID: ""
      module:
        source: app.terraform.io/Mintel/private-s3-bucket/aws
        version: 2.0.5
      omitNamespacePrefix: true
      organization: Mintel
      secretsMountPath: /tmp/secrets
      sshKeyID: mintel-ssh
      terraformVersion: 1.2.9
      variables:
        - environmentVariable: false
          hcl: false
          key: aws_account_name
          sensitive: false
          value: dev
        - environmentVariable: false
          hcl: false
          key: aws_region
          sensitive: false
          value: eu-west-1
        - environmentVariable: false
          hcl: false
          key: eks_cluster_name
          sensitive: false
          value: cluster1
        - environmentVariable: false
          hcl: false
          key: enable_versioning
          sensitive: false
          value: "false"
        - environmentVariable: false
          hcl: false
          key: name
          sensitive: false
          value: mntl-test-app
        - environmentVariable: false
          hcl: false
          key: output_secret_name
          sensitive: false
          value: test-namespace/mntl-test-app/s3
        - environmentVariable: false
          hcl: true
          key: secret_tags
          sensitive: false
          value: '{access-project = "test-namespace-ops"}'
        - environmentVariable: false
          hcl: true
          key: tags
          sensitive: false
          value: |-
            {
              Application = "mntl-test-app"
              Component = "mntl-test-app"
              Owner = "sre"
              Project = "test-project"
            }
        - environmentVariable: false
          hcl: false
          key: tfcloud_agent
          sensitive: false
          value: "true"
Dev S3 module workspace name override:
  1: |
    apiVersion: app.terraform.io/v1alpha1
    kind: Workspace
    metadata:
      annotations:
        app.mintel.com/altManifestFileSuffix: mntl-test-app-s3
        app.mintel.com/placeholder: placeholder
        app.mintel.com/terraform-allow-destroy: "true"
        app.mintel.com/terraform-cloud-tags: env:dev,owner:sre,mod:s3
        app.mintel.com/terraform-owner: sre
        argocd.argoproj.io/sync-options: SkipDryRunOnMissingResource=true
        argocd.argoproj.io/sync-wave: "-40"
      labels:
        app.kubernetes.io/name: mntl-test-app-s3
        app.mintel.com/env: dev
        app.mintel.com/owner: sre
        app.mintel.com/region: eu-west-1
        name: mntl-test-app-s3
      name: i-have-been-overwritten
      namespace: test-namespace
    spec:
      agentPoolID: ""
      module:
        source: app.terraform.io/Mintel/private-s3-bucket/aws
        version: 2.0.5
      omitNamespacePrefix: true
      organization: Mintel
      secretsMountPath: /tmp/secrets
      sshKeyID: mintel-ssh
      terraformVersion: 1.2.9
      variables:
        - environmentVariable: false
          hcl: false
          key: aws_account_name
          sensitive: false
          value: dev
        - environmentVariable: false
          hcl: false
          key: aws_region
          sensitive: false
          value: eu-west-1
        - environmentVariable: false
          hcl: false
          key: eks_cluster_name
          sensitive: false
          value: cluster1
        - environmentVariable: false
          hcl: false
          key: enable_versioning
          sensitive: false
          value: "false"
        - environmentVariable: false
          hcl: false
          key: name
          sensitive: false
          value: mntl-test-app
        - environmentVariable: false
          hcl: false
          key: output_secret_name
          sensitive: false
          value: test-namespace/mntl-test-app/s3
        - environmentVariable: false
          hcl: true
          key: secret_tags
          sensitive: false
          value: '{access-project = "test-namespace-ops"}'
        - environmentVariable: false
          hcl: true
          key: tags
          sensitive: false
          value: |-
            {
              Application = "mntl-test-app"
              Component = "mntl-test-app"
              Owner = "sre"
              Project = "test-project"
            }
        - environmentVariable: false
          hcl: false
          key: tfcloud_agent
          sensitive: false
          value: "true"
Dev S3 module workspace with default (0) syncWave:
  1: |
    apiVersion: app.terraform.io/v1alpha1
    kind: Workspace
    metadata:
      annotations:
        app.mintel.com/altManifestFileSuffix: mntl-test-app-s3
        app.mintel.com/placeholder: placeholder
        app.mintel.com/terraform-allow-destroy: "true"
        app.mintel.com/terraform-cloud-tags: env:dev,owner:sre,mod:s3
        app.mintel.com/terraform-owner: sre
        argocd.argoproj.io/sync-options: SkipDryRunOnMissingResource=true
        argocd.argoproj.io/sync-wave: "0"
      labels:
        app.kubernetes.io/name: mntl-test-app-s3
        app.mintel.com/env: dev
        app.mintel.com/owner: sre
        app.mintel.com/region: eu-west-1
        name: mntl-test-app-s3
      name: dev-eu-west-1-cluster1-test-namespace-mntl-test-app-s3
      namespace: test-namespace
    spec:
      agentPoolID: ""
      module:
        source: app.terraform.io/Mintel/private-s3-bucket/aws
        version: 2.0.5
      omitNamespacePrefix: true
      organization: Mintel
      secretsMountPath: /tmp/secrets
      sshKeyID: mintel-ssh
      terraformVersion: 1.2.9
      variables:
        - environmentVariable: false
          hcl: false
          key: aws_account_name
          sensitive: false
          value: dev
        - environmentVariable: false
          hcl: false
          key: aws_region
          sensitive: false
          value: eu-west-1
        - environmentVariable: false
          hcl: false
          key: eks_cluster_name
          sensitive: false
          value: cluster1
        - environmentVariable: false
          hcl: false
          key: enable_versioning
          sensitive: false
          value: "false"
        - environmentVariable: false
          hcl: false
          key: name
          sensitive: false
          value: mntl-test-app
        - environmentVariable: false
          hcl: false
          key: output_secret_name
          sensitive: false
          value: test-namespace/mntl-test-app/s3
        - environmentVariable: false
          hcl: true
          key: secret_tags
          sensitive: false
          value: '{access-project = "test-namespace-ops"}'
        - environmentVariable: false
          hcl: true
          key: tags
          sensitive: false
          value: |-
            {
              Application = "test-app"
              Component = "test-app"
              Owner = "sre"
              Project = "test-project"
            }
        - environmentVariable: false
          hcl: false
          key: tfcloud_agent
          sensitive: false
          value: "true"
Dev S3 module workspace with modified syncWave:
  1: |
    apiVersion: app.terraform.io/v1alpha1
    kind: Workspace
    metadata:
      annotations:
        app.mintel.com/altManifestFileSuffix: mntl-test-app-s3
        app.mintel.com/placeholder: placeholder
        app.mintel.com/terraform-allow-destroy: "true"
        app.mintel.com/terraform-cloud-tags: env:dev,owner:sre,mod:s3
        app.mintel.com/terraform-owner: sre
        argocd.argoproj.io/sync-options: SkipDryRunOnMissingResource=true
        argocd.argoproj.io/sync-wave: "200"
      labels:
        app.kubernetes.io/name: mntl-test-app-s3
        app.mintel.com/env: dev
        app.mintel.com/owner: sre
        app.mintel.com/region: eu-west-1
        name: mntl-test-app-s3
      name: dev-eu-west-1-cluster1-test-namespace-mntl-test-app-s3
      namespace: test-namespace
    spec:
      agentPoolID: ""
      module:
        source: app.terraform.io/Mintel/private-s3-bucket/aws
        version: 2.0.5
      omitNamespacePrefix: true
      organization: Mintel
      secretsMountPath: /tmp/secrets
      sshKeyID: mintel-ssh
      terraformVersion: 1.2.9
      variables:
        - environmentVariable: false
          hcl: false
          key: aws_account_name
          sensitive: false
          value: dev
        - environmentVariable: false
          hcl: false
          key: aws_region
          sensitive: false
          value: eu-west-1
        - environmentVariable: false
          hcl: false
          key: eks_cluster_name
          sensitive: false
          value: cluster1
        - environmentVariable: false
          hcl: false
          key: enable_versioning
          sensitive: false
          value: "false"
        - environmentVariable: false
          hcl: false
          key: name
          sensitive: false
          value: mntl-test-app
        - environmentVariable: false
          hcl: false
          key: output_secret_name
          sensitive: false
          value: test-namespace/mntl-test-app/s3
        - environmentVariable: false
          hcl: true
          key: secret_tags
          sensitive: false
          value: '{access-project = "test-namespace-ops"}'
        - environmentVariable: false
          hcl: true
          key: tags
          sensitive: false
          value: |-
            {
              Application = "test-app"
              Component = "test-app"
              Owner = "sre"
              Project = "test-project"
            }
        - environmentVariable: false
          hcl: false
          key: tfcloud_agent
          sensitive: false
          value: "true"
Dev S3 module workspace with multiple instances:
  1: |
    apiVersion: app.terraform.io/v1alpha1
    kind: Workspace
    metadata:
      annotations:
        app.mintel.com/altManifestFileSuffix: mntl-test-bucket-s3
        app.mintel.com/placeholder: placeholder
        app.mintel.com/terraform-allow-destroy: "true"
        app.mintel.com/terraform-cloud-tags: env:dev,owner:sre,mod:s3
        app.mintel.com/terraform-owner: sre
        argocd.argoproj.io/sync-options: SkipDryRunOnMissingResource=true
        argocd.argoproj.io/sync-wave: "-40"
      labels:
        app.kubernetes.io/name: mntl-test-bucket-s3
        app.mintel.com/env: dev
        app.mintel.com/owner: sre
        app.mintel.com/region: eu-west-1
        name: mntl-test-bucket-s3
      name: dev-eu-west-1-cluster1-test-namespace-mntl-test-bucket-s3
      namespace: test-namespace
    spec:
      agentPoolID: ""
      module:
        source: app.terraform.io/Mintel/private-s3-bucket/aws
        version: 2.0.5
      omitNamespacePrefix: true
      organization: Mintel
      secretsMountPath: /tmp/secrets
      sshKeyID: mintel-ssh
      terraformVersion: 1.2.9
      variables:
        - environmentVariable: false
          hcl: false
          key: aws_account_name
          sensitive: false
          value: dev
        - environmentVariable: false
          hcl: false
          key: aws_region
          sensitive: false
          value: eu-west-1
        - environmentVariable: false
          hcl: false
          key: eks_cluster_name
          sensitive: false
          value: cluster1
        - environmentVariable: false
          hcl: false
          key: enable_versioning
          sensitive: false
          value: "false"
        - environmentVariable: false
          hcl: false
          key: name
          sensitive: false
          value: mntl-test-bucket
        - environmentVariable: false
          hcl: false
          key: output_secret_name
          sensitive: false
          value: test-namespace/mntl-test-bucket/s3
        - environmentVariable: false
          hcl: true
          key: secret_tags
          sensitive: false
          value: '{access-project = "test-namespace-ops"}'
        - environmentVariable: false
          hcl: true
          key: tags
          sensitive: false
          value: |-
            {
              Application = "test-app"
              Component = "test-app"
              Owner = "sre"
              Project = "test-project"
            }
        - environmentVariable: false
          hcl: false
          key: tfcloud_agent
          sensitive: false
          value: "true"
  2: |
    apiVersion: app.terraform.io/v1alpha1
    kind: Workspace
    metadata:
      annotations:
        app.mintel.com/altManifestFileSuffix: mntl-test-bucket-another-s3
        app.mintel.com/placeholder: placeholder
        app.mintel.com/terraform-allow-destroy: "true"
        app.mintel.com/terraform-cloud-tags: env:dev,owner:sre,mod:s3
        app.mintel.com/terraform-owner: sre
        argocd.argoproj.io/sync-options: SkipDryRunOnMissingResource=true
        argocd.argoproj.io/sync-wave: "-40"
      labels:
        app.kubernetes.io/name: mntl-test-bucket-another-s3
        app.mintel.com/env: dev
        app.mintel.com/owner: sre
        app.mintel.com/region: eu-west-1
        name: mntl-test-bucket-another-s3
      name: dev-eu-west-1-cluster1-test-namespace-mntl-test-bucket-another-s3
      namespace: test-namespace
    spec:
      agentPoolID: ""
      module:
        source: app.terraform.io/Mintel/private-s3-bucket/aws
        version: 2.0.5
      omitNamespacePrefix: true
      organization: Mintel
      secretsMountPath: /tmp/secrets
      sshKeyID: mintel-ssh
      terraformVersion: 1.2.9
      variables:
        - environmentVariable: false
          hcl: false
          key: aws_account_name
          sensitive: false
          value: dev
        - environmentVariable: false
          hcl: false
          key: aws_region
          sensitive: false
          value: eu-west-1
        - environmentVariable: false
          hcl: false
          key: eks_cluster_name
          sensitive: false
          value: cluster1
        - environmentVariable: false
          hcl: false
          key: enable_versioning
          sensitive: false
          value: "false"
        - environmentVariable: false
          hcl: false
          key: name
          sensitive: false
          value: mntl-test-bucket-another
        - environmentVariable: false
          hcl: false
          key: output_secret_name
          sensitive: false
          value: test-namespace/mntl-test-bucket-another/s3
        - environmentVariable: false
          hcl: true
          key: secret_tags
          sensitive: false
          value: '{access-project = "test-namespace-ops"}'
        - environmentVariable: false
          hcl: true
          key: tags
          sensitive: false
          value: |-
            {
              Application = "test-app"
              Component = "test-app"
              Owner = "sre"
              Project = "test-project"
            }
        - environmentVariable: false
          hcl: false
          key: tfcloud_agent
          sensitive: false
          value: "true"
Dev S3 module workspace with multiple instances - tags:
  1: |
    apiVersion: app.terraform.io/v1alpha1
    kind: Workspace
    metadata:
      annotations:
        app.mintel.com/altManifestFileSuffix: test-instance-one-sqs
        app.mintel.com/placeholder: placeholder
        app.mintel.com/terraform-allow-destroy: "true"
        app.mintel.com/terraform-cloud-tags: env:dev,owner:sre,mod:sqs
        app.mintel.com/terraform-owner: sre
        argocd.argoproj.io/sync-options: SkipDryRunOnMissingResource=true
        argocd.argoproj.io/sync-wave: "-40"
      labels:
        app.kubernetes.io/name: test-instance-one-sqs
        app.mintel.com/env: dev
        app.mintel.com/owner: sre
        app.mintel.com/region: eu-west-1
        name: test-instance-one-sqs
      name: dev-eu-west-1-cluster1-test-namespace-test-instance-one-sqs
      namespace: test-namespace
    spec:
      agentPoolID: ""
      module:
        source: app.terraform.io/Mintel/sqs/aws
        version: 1.2.0
      omitNamespacePrefix: true
      organization: Mintel
      secretsMountPath: /tmp/secrets
      sshKeyID: mintel-ssh
      terraformVersion: 1.2.9
      variables:
        - environmentVariable: false
          hcl: false
          key: aws_account_name
          sensitive: false
          value: dev
        - environmentVariable: false
          hcl: false
          key: aws_region
          sensitive: false
          value: eu-west-1
        - environmentVariable: false
          hcl: false
          key: eks_cluster_name
          sensitive: false
          value: cluster1
        - environmentVariable: false
          hcl: false
          key: name
          sensitive: false
          value: test-instance-one
        - environmentVariable: false
          hcl: false
          key: output_secret_name
          sensitive: false
          value: test-namespace/test-instance-one/sqs
        - environmentVariable: false
          hcl: true
          key: secret_tags
          sensitive: false
          value: '{access-project = "test-namespace-ops"}'
        - environmentVariable: false
          hcl: true
          key: tags
          sensitive: false
          value: |-
            {
              Application = "test-app"
              Component = "test-app"
              ExtraTagOne = "testTagValueOne"
              MintelEventBus = "true"
              Owner = "sre"
              Project = "test-project"
            }
        - environmentVariable: false
          hcl: false
          key: tfcloud_agent
          sensitive: false
          value: "true"
  2: |
    apiVersion: app.terraform.io/v1alpha1
    kind: Workspace
    metadata:
      annotations:
        app.mintel.com/altManifestFileSuffix: test-instance-two-sqs
        app.mintel.com/placeholder: placeholder
        app.mintel.com/terraform-allow-destroy: "true"
        app.mintel.com/terraform-cloud-tags: env:dev,owner:sre,mod:sqs
        app.mintel.com/terraform-owner: sre
        argocd.argoproj.io/sync-options: SkipDryRunOnMissingResource=true
        argocd.argoproj.io/sync-wave: "-40"
      labels:
        app.kubernetes.io/name: test-instance-two-sqs
        app.mintel.com/env: dev
        app.mintel.com/owner: sre
        app.mintel.com/region: eu-west-1
        name: test-instance-two-sqs
      name: dev-eu-west-1-cluster1-test-namespace-test-instance-two-sqs
      namespace: test-namespace
    spec:
      agentPoolID: ""
      module:
        source: app.terraform.io/Mintel/sqs/aws
        version: 1.2.0
      omitNamespacePrefix: true
      organization: Mintel
      secretsMountPath: /tmp/secrets
      sshKeyID: mintel-ssh
      terraformVersion: 1.2.9
      variables:
        - environmentVariable: false
          hcl: false
          key: aws_account_name
          sensitive: false
          value: dev
        - environmentVariable: false
          hcl: false
          key: aws_region
          sensitive: false
          value: eu-west-1
        - environmentVariable: false
          hcl: false
          key: eks_cluster_name
          sensitive: false
          value: cluster1
        - environmentVariable: false
          hcl: false
          key: name
          sensitive: false
          value: test-instance-two
        - environmentVariable: false
          hcl: false
          key: output_secret_name
          sensitive: false
          value: test-namespace/test-instance-two/sqs
        - environmentVariable: false
          hcl: true
          key: secret_tags
          sensitive: false
          value: '{access-project = "test-namespace-ops"}'
        - environmentVariable: false
          hcl: true
          key: tags
          sensitive: false
          value: |-
            {
              Application = "test-app"
              Component = "test-app"
              ExtraTagOne = "testTagValueOne"
              ExtraTagTwo = "testTagValueTwo"
              MintelEventBus = "true"
              Owner = "sre"
              Project = "test-project"
            }
        - environmentVariable: false
          hcl: false
          key: tfcloud_agent
          sensitive: false
          value: "true"
Dev S3 module workspace with multiple instances and syncWave overrides:
  1: |
    apiVersion: app.terraform.io/v1alpha1
    kind: Workspace
    metadata:
      annotations:
        app.mintel.com/altManifestFileSuffix: mntl-test-bucket-s3
        app.mintel.com/placeholder: placeholder
        app.mintel.com/terraform-allow-destroy: "true"
        app.mintel.com/terraform-cloud-tags: env:dev,owner:sre,mod:s3
        app.mintel.com/terraform-owner: sre
        argocd.argoproj.io/sync-options: SkipDryRunOnMissingResource=true
        argocd.argoproj.io/sync-wave: "200"
      labels:
        app.kubernetes.io/name: mntl-test-bucket-s3
        app.mintel.com/env: dev
        app.mintel.com/owner: sre
        app.mintel.com/region: eu-west-1
        name: mntl-test-bucket-s3
      name: dev-eu-west-1-cluster1-test-namespace-mntl-test-bucket-s3
      namespace: test-namespace
    spec:
      agentPoolID: ""
      module:
        source: app.terraform.io/Mintel/private-s3-bucket/aws
        version: 2.0.5
      omitNamespacePrefix: true
      organization: Mintel
      secretsMountPath: /tmp/secrets
      sshKeyID: mintel-ssh
      terraformVersion: 1.2.9
      variables:
        - environmentVariable: false
          hcl: false
          key: aws_account_name
          sensitive: false
          value: dev
        - environmentVariable: false
          hcl: false
          key: aws_region
          sensitive: false
          value: eu-west-1
        - environmentVariable: false
          hcl: false
          key: eks_cluster_name
          sensitive: false
          value: cluster1
        - environmentVariable: false
          hcl: false
          key: enable_versioning
          sensitive: false
          value: "false"
        - environmentVariable: false
          hcl: false
          key: name
          sensitive: false
          value: mntl-test-bucket
        - environmentVariable: false
          hcl: false
          key: output_secret_name
          sensitive: false
          value: test-namespace/mntl-test-bucket/s3
        - environmentVariable: false
          hcl: true
          key: secret_tags
          sensitive: false
          value: '{access-project = "test-namespace-ops"}'
        - environmentVariable: false
          hcl: true
          key: tags
          sensitive: false
          value: |-
            {
              Application = "test-app"
              Component = "test-app"
              Owner = "sre"
              Project = "test-project"
            }
        - environmentVariable: false
          hcl: false
          key: tfcloud_agent
          sensitive: false
          value: "true"
  2: |
    apiVersion: app.terraform.io/v1alpha1
    kind: Workspace
    metadata:
      annotations:
        app.mintel.com/altManifestFileSuffix: mntl-test-bucket-another-s3
        app.mintel.com/placeholder: placeholder
        app.mintel.com/terraform-allow-destroy: "true"
        app.mintel.com/terraform-cloud-tags: env:dev,owner:sre,mod:s3
        app.mintel.com/terraform-owner: sre
        argocd.argoproj.io/sync-options: SkipDryRunOnMissingResource=true
        argocd.argoproj.io/sync-wave: "300"
      labels:
        app.kubernetes.io/name: mntl-test-bucket-another-s3
        app.mintel.com/env: dev
        app.mintel.com/owner: sre
        app.mintel.com/region: eu-west-1
        name: mntl-test-bucket-another-s3
      name: dev-eu-west-1-cluster1-test-namespace-mntl-test-bucket-another-s3
      namespace: test-namespace
    spec:
      agentPoolID: ""
      module:
        source: app.terraform.io/Mintel/private-s3-bucket/aws
        version: 2.0.5
      omitNamespacePrefix: true
      organization: Mintel
      secretsMountPath: /tmp/secrets
      sshKeyID: mintel-ssh
      terraformVersion: 1.2.9
      variables:
        - environmentVariable: false
          hcl: false
          key: aws_account_name
          sensitive: false
          value: dev
        - environmentVariable: false
          hcl: false
          key: aws_region
          sensitive: false
          value: eu-west-1
        - environmentVariable: false
          hcl: false
          key: eks_cluster_name
          sensitive: false
          value: cluster1
        - environmentVariable: false
          hcl: false
          key: enable_versioning
          sensitive: false
          value: "false"
        - environmentVariable: false
          hcl: false
          key: name
          sensitive: false
          value: mntl-test-bucket-another
        - environmentVariable: false
          hcl: false
          key: output_secret_name
          sensitive: false
          value: test-namespace/mntl-test-bucket-another/s3
        - environmentVariable: false
          hcl: true
          key: secret_tags
          sensitive: false
          value: '{access-project = "test-namespace-ops"}'
        - environmentVariable: false
          hcl: true
          key: tags
          sensitive: false
          value: |-
            {
              Application = "test-app"
              Component = "test-app"
              Owner = "sre"
              Project = "test-project"
            }
        - environmentVariable: false
          hcl: false
          key: tfcloud_agent
          sensitive: false
          value: "true"
Test workspace allow destroy env:
  1: |
    apiVersion: app.terraform.io/v1alpha1
    kind: Workspace
    metadata:
      annotations:
        app.mintel.com/altManifestFileSuffix: mntl-test-app-s3
        app.mintel.com/placeholder: placeholder
        app.mintel.com/terraform-allow-destroy: "false"
        app.mintel.com/terraform-cloud-tags: env:prod,owner:sre,mod:s3
        app.mintel.com/terraform-owner: sre
        argocd.argoproj.io/sync-options: SkipDryRunOnMissingResource=true
        argocd.argoproj.io/sync-wave: "-40"
      labels:
        app.kubernetes.io/name: mntl-test-app-s3
        app.mintel.com/env: prod
        app.mintel.com/owner: sre
        app.mintel.com/region: eu-west-1
        name: mntl-test-app-s3
      name: prod-eu-west-1-cluster1-test-namespace-mntl-test-app-s3
      namespace: test-namespace
    spec:
      agentPoolID: ""
      module:
        source: app.terraform.io/Mintel/private-s3-bucket/aws
        version: 2.0.5
      omitNamespacePrefix: true
      organization: Mintel
      secretsMountPath: /tmp/secrets
      sshKeyID: mintel-ssh
      terraformVersion: 1.2.9
      variables:
        - environmentVariable: false
          hcl: false
          key: aws_account_name
          sensitive: false
          value: prod
        - environmentVariable: false
          hcl: false
          key: aws_region
          sensitive: false
          value: eu-west-1
        - environmentVariable: false
          hcl: false
          key: eks_cluster_name
          sensitive: false
          value: cluster1
        - environmentVariable: false
          hcl: false
          key: name
          sensitive: false
          value: mntl-test-app
        - environmentVariable: false
          hcl: false
          key: output_secret_name
          sensitive: false
          value: test-namespace/mntl-test-app/s3
        - environmentVariable: false
          hcl: true
          key: secret_tags
          sensitive: false
          value: '{access-project = "test-namespace-ops"}'
        - environmentVariable: false
          hcl: true
          key: tags
          sensitive: false
          value: |-
            {
              Application = "test-app"
              Component = "test-app"
              Owner = "sre"
              Project = "test-project"
            }
        - environmentVariable: false
          hcl: false
          key: tfcloud_agent
          sensitive: false
          value: "true"
Test workspace extra annotations:
  1: |
    apiVersion: app.terraform.io/v1alpha1
    kind: Workspace
    metadata:
      annotations:
        app.mintel.com/altManifestFileSuffix: mntl-test-app-s3
        app.mintel.com/placeholder: placeholder
        app.mintel.com/terraform-allow-destroy: "true"
        app.mintel.com/terraform-cloud-tags: env:dev,owner:sre,mod:s3
        app.mintel.com/terraform-owner: sre
        argocd.argoproj.io/sync-options: SkipDryRunOnMissingResource=true
        argocd.argoproj.io/sync-wave: "-40"
      labels:
        app.kubernetes.io/name: mntl-test-app-s3
        app.mintel.com/env: dev
        app.mintel.com/owner: sre
        app.mintel.com/region: eu-west-1
        name: mntl-test-app-s3
      name: dev-eu-west-1-cluster1-test-namespace-mntl-test-app-s3
      namespace: test-namespace
    spec:
      agentPoolID: ""
      module:
        source: app.terraform.io/Mintel/private-s3-bucket/aws
        version: 2.0.5
      omitNamespacePrefix: true
      organization: Mintel
      secretsMountPath: /tmp/secrets
      sshKeyID: mintel-ssh
      terraformVersion: 1.2.9
      variables:
        - environmentVariable: false
          hcl: false
          key: aws_account_name
          sensitive: false
          value: dev
        - environmentVariable: false
          hcl: false
          key: aws_region
          sensitive: false
          value: eu-west-1
        - environmentVariable: false
          hcl: false
          key: eks_cluster_name
          sensitive: false
          value: cluster1
        - environmentVariable: false
          hcl: false
          key: enable_versioning
          sensitive: false
          value: "false"
        - environmentVariable: false
          hcl: false
          key: name
          sensitive: false
          value: mntl-test-app
        - environmentVariable: false
          hcl: false
          key: output_secret_name
          sensitive: false
          value: test-namespace/mntl-test-app/s3
        - environmentVariable: false
          hcl: true
          key: secret_tags
          sensitive: false
          value: '{access-project = "test-namespace-ops"}'
        - environmentVariable: false
          hcl: true
          key: tags
          sensitive: false
          value: |-
            {
              Application = "test-app"
              Component = "test-app"
              Owner = "sre"
              Project = "test-project"
            }
        - environmentVariable: false
          hcl: false
          key: tfcloud_agent
          sensitive: false
          value: "true"
Test workspace extra annotations override:
  1: |
    apiVersion: app.terraform.io/v1alpha1
    kind: Workspace
    metadata:
      annotations:
        app.mintel.com/altManifestFileSuffix: mntl-test-app-s3
        app.mintel.com/placeholder: placeholder
        app.mintel.com/terraform-allow-destroy: "false"
        app.mintel.com/terraform-cloud-tags: test
        app.mintel.com/terraform-owner: override
        argocd.argoproj.io/sync-options: SkipDryRunOnMissingResource=true
        argocd.argoproj.io/sync-wave: "-40"
      labels:
        app.kubernetes.io/name: mntl-test-app-s3
        app.mintel.com/env: dev
        app.mintel.com/owner: sre
        app.mintel.com/region: eu-west-1
        name: mntl-test-app-s3
      name: dev-eu-west-1-cluster1-test-namespace-mntl-test-app-s3
      namespace: test-namespace
    spec:
      agentPoolID: ""
      module:
        source: app.terraform.io/Mintel/private-s3-bucket/aws
        version: 2.0.5
      omitNamespacePrefix: true
      organization: Mintel
      secretsMountPath: /tmp/secrets
      sshKeyID: mintel-ssh
      terraformVersion: 1.2.9
      variables:
        - environmentVariable: false
          hcl: false
          key: aws_account_name
          sensitive: false
          value: dev
        - environmentVariable: false
          hcl: false
          key: aws_region
          sensitive: false
          value: eu-west-1
        - environmentVariable: false
          hcl: false
          key: eks_cluster_name
          sensitive: false
          value: cluster1
        - environmentVariable: false
          hcl: false
          key: enable_versioning
          sensitive: false
          value: "false"
        - environmentVariable: false
          hcl: false
          key: name
          sensitive: false
          value: mntl-test-app
        - environmentVariable: false
          hcl: false
          key: output_secret_name
          sensitive: false
          value: test-namespace/mntl-test-app/s3
        - environmentVariable: false
          hcl: true
          key: secret_tags
          sensitive: false
          value: '{access-project = "test-namespace-ops"}'
        - environmentVariable: false
          hcl: true
          key: tags
          sensitive: false
          value: |-
            {
              Application = "test-app"
              Component = "test-app"
              Owner = "sre"
              Project = "test-project"
            }
        - environmentVariable: false
          hcl: false
          key: tfcloud_agent
          sensitive: false
          value: "true"
